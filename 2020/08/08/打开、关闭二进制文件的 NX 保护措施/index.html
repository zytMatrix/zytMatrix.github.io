<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="打开、关闭二进制文件的 NX 保护措施一、 checksec中检查 NX 的代码部分1234567891011# check for NX support$&amp;#123;debug&amp;#125; &amp;&amp; echo -e &quot;\n***function filecheck-&gt;nx&quot;if $&amp;#123;readelf&amp;#125; -l &quot;$&amp;#123;1&amp;#125;&quot; 2&gt;&#x2F;dev">
<meta property="og:type" content="article">
<meta property="og:title" content="打开、关闭二进制文件的 NX 保护措施">
<meta property="og:url" content="http://yoursite.com/2020/08/08/%E6%89%93%E5%BC%80%E3%80%81%E5%85%B3%E9%97%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%20NX%20%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/index.html">
<meta property="og:site_name" content="Matrix">
<meta property="og:description" content="打开、关闭二进制文件的 NX 保护措施一、 checksec中检查 NX 的代码部分1234567891011# check for NX support$&amp;#123;debug&amp;#125; &amp;&amp; echo -e &quot;\n***function filecheck-&gt;nx&quot;if $&amp;#123;readelf&amp;#125; -l &quot;$&amp;#123;1&amp;#125;&quot; 2&gt;&#x2F;dev">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/08/08/%E6%89%93%E5%BC%80%E3%80%81%E5%85%B3%E9%97%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%20NX%20%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/program%20header%20&&%20section%20header.png">
<meta property="og:image" content="https://raw.githubusercontent.com/corkami/pics/28cb0226093ed57b348723bc473cea0162dad366/binary/elf101/elf101.svg">
<meta property="og:image" content="http://yoursite.com/2020/08/08/%E6%89%93%E5%BC%80%E3%80%81%E5%85%B3%E9%97%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%20NX%20%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/elf32_bit.svg">
<meta property="article:published_time" content="2020-08-08T11:29:05.000Z">
<meta property="article:modified_time" content="2020-08-08T11:42:33.194Z">
<meta property="article:author" content="zyt">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/08/08/%E6%89%93%E5%BC%80%E3%80%81%E5%85%B3%E9%97%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%20NX%20%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/program%20header%20&&%20section%20header.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/08/08/打开、关闭二进制文件的 NX 保护措施/"/>





  <title>打开、关闭二进制文件的 NX 保护措施 | Matrix</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Matrix</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/08/%E6%89%93%E5%BC%80%E3%80%81%E5%85%B3%E9%97%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%20NX%20%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zyt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Matrix">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">打开、关闭二进制文件的 NX 保护措施</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-08-08T19:29:05+08:00">
                2020-08-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ELF/" itemprop="url" rel="index">
                    <span itemprop="name">ELF</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="打开、关闭二进制文件的-NX-保护措施"><a href="#打开、关闭二进制文件的-NX-保护措施" class="headerlink" title="打开、关闭二进制文件的 NX 保护措施"></a>打开、关闭二进制文件的 NX 保护措施</h2><h3 id="一、-checksec中检查-NX-的代码部分"><a href="#一、-checksec中检查-NX-的代码部分" class="headerlink" title="一、 checksec中检查 NX 的代码部分"></a>一、 checksec中检查 NX 的代码部分</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># check for NX support</span></span><br><span class="line"><span class="variable">$&#123;debug&#125;</span> &amp;&amp; <span class="built_in">echo</span> -e <span class="string">"\n***function filecheck-&gt;nx"</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable">$&#123;readelf&#125;</span> -l <span class="string">"<span class="variable">$&#123;1&#125;</span>"</span> 2&gt;/dev/null | grep -q <span class="string">'GNU_STACK'</span>; <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> <span class="variable">$&#123;readelf&#125;</span> -l <span class="string">"<span class="variable">$&#123;1&#125;</span>"</span> 2&gt;/dev/null | grep <span class="string">'GNU_STACK'</span> | grep -q <span class="string">'RWE'</span>; <span class="keyword">then</span></span><br><span class="line">		echo_message <span class="string">'\033[31mNX disabled\033[m   '</span> <span class="string">'NX disabled,'</span> <span class="string">' nx="no"'</span> <span class="string">'"nx":"no",'</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		echo_message <span class="string">'\033[32mNX enabled \033[m   '</span> <span class="string">'NX enabled,'</span> <span class="string">' nx="yes"'</span> <span class="string">'"nx":"yes",'</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	echo_message <span class="string">'\033[31mNX disabled\033[m   '</span> <span class="string">'NX disabled,'</span> <span class="string">' nx="no"'</span> <span class="string">'"nx":"no",'</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>本质上调用了<code>readelf -l</code>来进行判断的：</p>
<ul>
<li>不开启栈执行</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~ <span class="meta"># gcc -w -z noexecstack -o test test.c -m32</span></span><br><span class="line">root@ubuntu:~ <span class="meta"># readelf -l test</span></span><br><span class="line"></span><br><span class="line"><span class="function">Elf file type is <span class="title">EXEC</span> <span class="params">(Executable file)</span></span></span><br><span class="line"><span class="function">Entry <span class="built_in">point</span> 0x80482e0</span></span><br><span class="line">There are 9 program headers, starting at offset 52</span><br><span class="line"></span><br><span class="line">Program Headers:</span><br><span class="line">  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align</span><br><span class="line">  PHDR           <span class="number">0x000034</span> <span class="number">0x08048034</span> <span class="number">0x08048034</span> <span class="number">0x00120</span> <span class="number">0x00120</span> R E <span class="number">0x4</span></span><br><span class="line">  INTERP         <span class="number">0x000154</span> <span class="number">0x08048154</span> <span class="number">0x08048154</span> <span class="number">0x00013</span> <span class="number">0x00013</span> R   <span class="number">0x1</span></span><br><span class="line">      [Requesting program interpreter: /lib/ld-linux.so<span class="number">.2</span>]</span><br><span class="line">  LOAD           <span class="number">0x000000</span> <span class="number">0x08048000</span> <span class="number">0x08048000</span> <span class="number">0x00588</span> <span class="number">0x00588</span> R E <span class="number">0x1000</span></span><br><span class="line">  LOAD           <span class="number">0x000f08</span> <span class="number">0x08049f08</span> <span class="number">0x08049f08</span> <span class="number">0x00169</span> <span class="number">0x0016c</span> RW  <span class="number">0x1000</span></span><br><span class="line">  DYNAMIC        <span class="number">0x000f14</span> <span class="number">0x08049f14</span> <span class="number">0x08049f14</span> <span class="number">0x000e8</span> <span class="number">0x000e8</span> RW  <span class="number">0x4</span></span><br><span class="line">  NOTE           <span class="number">0x000168</span> <span class="number">0x08048168</span> <span class="number">0x08048168</span> <span class="number">0x00044</span> <span class="number">0x00044</span> R   <span class="number">0x4</span></span><br><span class="line">  GNU_EH_FRAME   <span class="number">0x000490</span> <span class="number">0x08048490</span> <span class="number">0x08048490</span> <span class="number">0x0002c</span> <span class="number">0x0002c</span> R   <span class="number">0x4</span></span><br><span class="line">  GNU_STACK      <span class="number">0x000000</span> <span class="number">0x00000000</span> <span class="number">0x00000000</span> <span class="number">0x00000</span> <span class="number">0x00000</span> RW  <span class="number">0x10</span></span><br><span class="line">  GNU_RELRO      <span class="number">0x000f08</span> <span class="number">0x08049f08</span> <span class="number">0x08049f08</span> <span class="number">0x000f8</span> <span class="number">0x000f8</span> R   <span class="number">0x1</span></span><br><span class="line"></span><br><span class="line"> Section to Segment mapping:</span><br><span class="line">  Segment Sections...</span><br><span class="line">   <span class="number">00</span>     </span><br><span class="line">   <span class="number">01</span>     .interp </span><br><span class="line">   <span class="number">02</span>     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .plt.got .<span class="built_in">text</span> .fini .rodata .eh_frame_hdr .eh_frame </span><br><span class="line">   <span class="number">03</span>     .init_array .fini_array .jcr .dynamic .got .got.plt .data .bss </span><br><span class="line">   <span class="number">04</span>     .dynamic </span><br><span class="line">   <span class="number">05</span>     .note.ABI-tag .note.gnu.build-id </span><br><span class="line">   <span class="number">06</span>     .eh_frame_hdr </span><br><span class="line">   <span class="number">07</span>     </span><br><span class="line">   <span class="number">08</span>     .init_array .fini_array .jcr .dynamic .got</span><br></pre></td></tr></table></figure>

<ul>
<li>开启栈执行</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~ <span class="meta"># gcc -w -z execstack -o test test.c -m32</span></span><br><span class="line">root@ubuntu:~ <span class="meta"># readelf -l test</span></span><br><span class="line"></span><br><span class="line"><span class="function">Elf file type is <span class="title">EXEC</span> <span class="params">(Executable file)</span></span></span><br><span class="line"><span class="function">Entry <span class="built_in">point</span> 0x80482e0</span></span><br><span class="line">There are 9 program headers, starting at offset 52</span><br><span class="line"></span><br><span class="line">Program Headers:</span><br><span class="line">  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align</span><br><span class="line">  PHDR           <span class="number">0x000034</span> <span class="number">0x08048034</span> <span class="number">0x08048034</span> <span class="number">0x00120</span> <span class="number">0x00120</span> R E <span class="number">0x4</span></span><br><span class="line">  INTERP         <span class="number">0x000154</span> <span class="number">0x08048154</span> <span class="number">0x08048154</span> <span class="number">0x00013</span> <span class="number">0x00013</span> R   <span class="number">0x1</span></span><br><span class="line">      [Requesting program interpreter: /lib/ld-linux.so<span class="number">.2</span>]</span><br><span class="line">  LOAD           <span class="number">0x000000</span> <span class="number">0x08048000</span> <span class="number">0x08048000</span> <span class="number">0x00588</span> <span class="number">0x00588</span> R E <span class="number">0x1000</span></span><br><span class="line">  LOAD           <span class="number">0x000f08</span> <span class="number">0x08049f08</span> <span class="number">0x08049f08</span> <span class="number">0x00169</span> <span class="number">0x0016c</span> RW  <span class="number">0x1000</span></span><br><span class="line">  DYNAMIC        <span class="number">0x000f14</span> <span class="number">0x08049f14</span> <span class="number">0x08049f14</span> <span class="number">0x000e8</span> <span class="number">0x000e8</span> RW  <span class="number">0x4</span></span><br><span class="line">  NOTE           <span class="number">0x000168</span> <span class="number">0x08048168</span> <span class="number">0x08048168</span> <span class="number">0x00044</span> <span class="number">0x00044</span> R   <span class="number">0x4</span></span><br><span class="line">  GNU_EH_FRAME   <span class="number">0x000490</span> <span class="number">0x08048490</span> <span class="number">0x08048490</span> <span class="number">0x0002c</span> <span class="number">0x0002c</span> R   <span class="number">0x4</span></span><br><span class="line">  GNU_STACK      <span class="number">0x000000</span> <span class="number">0x00000000</span> <span class="number">0x00000000</span> <span class="number">0x00000</span> <span class="number">0x00000</span> RWE <span class="number">0x10</span></span><br><span class="line">  GNU_RELRO      <span class="number">0x000f08</span> <span class="number">0x08049f08</span> <span class="number">0x08049f08</span> <span class="number">0x000f8</span> <span class="number">0x000f8</span> R   <span class="number">0x1</span></span><br><span class="line"></span><br><span class="line"> Section to Segment mapping:</span><br><span class="line">  Segment Sections...</span><br><span class="line">   <span class="number">00</span>     </span><br><span class="line">   <span class="number">01</span>     .interp </span><br><span class="line">   <span class="number">02</span>     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .plt.got .<span class="built_in">text</span> .fini .rodata .eh_frame_hdr .eh_frame </span><br><span class="line">   <span class="number">03</span>     .init_array .fini_array .jcr .dynamic .got .got.plt .data .bss </span><br><span class="line">   <span class="number">04</span>     .dynamic </span><br><span class="line">   <span class="number">05</span>     .note.ABI-tag .note.gnu.build-id </span><br><span class="line">   <span class="number">06</span>     .eh_frame_hdr </span><br><span class="line">   <span class="number">07</span>     </span><br><span class="line">   <span class="number">08</span>     .init_array .fini_array .jcr .dynamic .got</span><br></pre></td></tr></table></figure>

<h3 id="二、Program-header"><a href="#二、Program-header" class="headerlink" title="二、Program header"></a>二、Program header</h3><img src="/2020/08/08/%E6%89%93%E5%BC%80%E3%80%81%E5%85%B3%E9%97%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%20NX%20%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/program header && section header.png" alt="image-20200808192343332" style="zoom:50%;">

<p><code>program header</code>表告诉系统如何创建一个进程镜像。他在文件中的偏移由字段<code>e_phoff</code>指定，包含<code>e_phnum</code>个实体，每一个的大小为<code>e_phentsize</code>。32位和64位的数据结构略有不同，由于对齐的原因，字段<code>p_flags</code>在结构体中的位置不同，每一个实体的结构为：</p>
<table>
<thead>
<tr>
<th align="center">Offset</th>
<th align="center">Offset</th>
<th align="center">Size (bytes)</th>
<th align="center">Size (bytes)</th>
<th>Field</th>
<th>Purpose</th>
</tr>
</thead>
<tbody><tr>
<td align="center">32-bit</td>
<td align="center">64-bit</td>
<td align="center">32-bit</td>
<td align="center">64-bit</td>
<td></td>
<td></td>
</tr>
<tr>
<td align="center">0x00</td>
<td align="center">0x00</td>
<td align="center">4</td>
<td align="center">4</td>
<td><code>p_type</code></td>
<td>Identifies the type of the segment. <br>Value            Name            Meaning<br>0x00000000<code>PT_NULL</code>Program header table entry unused<br>0x00000001<code>PT_LOAD</code>Loadable segment<br>0x00000002<code>PT_DYNAMIC</code>Dynamic linking information<br>0x00000003<code>PT_INTERP</code>Interpreter information<br>0x00000004<code>PT_NOTE</code>Auxiliary information<br>0x00000005<code>PT_SHLIB</code>reserved<br>0x00000006<code>PT_PHDR</code>segment containing program header table itself<br>0x00000007<code>PT_TLS</code>Thread-Local Storage template<br>0x60000000<code>PT_LOOS</code>see below<br>0x6FFFFFFF<code>PT_HIOS</code><br>0x70000000<code>PT_LOPROC</code><br>0x7FFFFFFF<code>PT_HIPROC</code><br><code>PT_LOOS</code> to <code>PT_HIOS</code> (<code>PT_LOPROC</code> to <code>PT_HIPROC</code>) is an inclusive reserved ranges for operating system (processor) specific semantics.</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">0x04</td>
<td align="center"></td>
<td align="center">4</td>
<td><code>p_flags</code></td>
<td>Segment-dependent flags (position for 64-bit structure).</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="center">0x08</td>
<td align="center">4</td>
<td align="center">8</td>
<td><code>p_offset</code></td>
<td>Offset of the segment in the file image.</td>
</tr>
<tr>
<td align="center">0x08</td>
<td align="center">0x10</td>
<td align="center">4</td>
<td align="center">8</td>
<td><code>p_vaddr</code></td>
<td>Virtual address of the segment in memory.</td>
</tr>
<tr>
<td align="center">0x0C</td>
<td align="center">0x18</td>
<td align="center">4</td>
<td align="center">8</td>
<td><code>p_paddr</code></td>
<td>On systems where physical address is relevant, reserved for segment’s physical address.</td>
</tr>
<tr>
<td align="center">0x10</td>
<td align="center">0x20</td>
<td align="center">4</td>
<td align="center">8</td>
<td><code>p_filesz</code></td>
<td>Size in bytes of the segment in the file image. May be 0.</td>
</tr>
<tr>
<td align="center">0x14</td>
<td align="center">0x28</td>
<td align="center">4</td>
<td align="center">8</td>
<td><code>p_memsz</code></td>
<td>Size in bytes of the segment in memory. May be 0.</td>
</tr>
<tr>
<td align="center">0x18</td>
<td align="center"></td>
<td align="center">4</td>
<td align="center"></td>
<td><code>p_flags</code></td>
<td>Segment-dependent flags (position for 32-bit structure).</td>
</tr>
<tr>
<td align="center">0x1C</td>
<td align="center">0x30</td>
<td align="center">4</td>
<td align="center">8</td>
<td><code>p_align</code></td>
<td><code>0</code> and <code>1</code> specify no alignment. Otherwise should be a positive, integral power of 2, with <code>p_vaddr</code> equating <code>p_offset</code> modulus <code>p_align</code>.</td>
</tr>
<tr>
<td align="center">0x20</td>
<td align="center">0x38</td>
<td align="center"></td>
<td align="center">End of Program Header (size)</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>由上可知：</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="left">32位</th>
<th>64位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">size of entry</td>
<td align="left">32B</td>
<td>64B</td>
</tr>
<tr>
<td align="center">offset of p_flags</td>
<td align="left">0x18</td>
<td>0x4</td>
</tr>
</tbody></table>
<p>在 program header 表中有一项 GNU_STACK，他的 flag 是 RWE，那么只要把它的 flag 改为 RW 就行了。 由上图可知 program header 的偏移是64，表中每一项的大小为0x20(32位）或0x38(64位）， p_flags字段的偏移是0x18（32位），0x4(64位）用 hexedit 手动把把那里的 7(RWX) 改为6 (RW) 就可以了。</p>
<h3 id="三、修改实例"><a href="#三、修改实例" class="headerlink" title="三、修改实例"></a>三、修改实例</h3><ul>
<li>开启的保护信息</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~ <span class="meta"># checksec test</span></span><br><span class="line">[*] '/root/test'</span><br><span class="line">    Arch:     i386<span class="number">-32</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x8048000</span>)</span></span></span><br><span class="line"><span class="function">    RWX:      Has RWX segments</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>ELF header 和 Program header</p>
<p>32位下，ELF header的大小为52B，后面是 Program header，</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000000</span>: <span class="number">7f</span>45 <span class="number">4</span>c46 <span class="number">0101</span> <span class="number">0100</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  .ELF............</span><br><span class="line"><span class="number">00000010</span>: <span class="number">0200</span> <span class="number">0300</span> <span class="number">0100</span> <span class="number">0000</span> e082 <span class="number">0408</span> <span class="number">3400</span> <span class="number">0000</span>  ...........<span class="number">.4</span>...</span><br><span class="line"><span class="number">00000020</span>: <span class="number">2818</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">3400</span> <span class="number">2000</span> <span class="number">0900</span> <span class="number">2800</span>  (......<span class="number">.4</span>. ...(.</span><br><span class="line"><span class="number">00000030</span>: <span class="number">1f</span>00 <span class="number">1</span>c00                                                   </span><br><span class="line">                   	<span class="number">0600</span> <span class="number">0000</span> <span class="number">3400</span> <span class="number">0000</span> <span class="number">3480</span> <span class="number">0408</span>  .......<span class="number">.4</span>..<span class="number">.4</span>...</span><br><span class="line"><span class="number">00000040</span>: <span class="number">3480</span> <span class="number">0408</span> <span class="number">2001</span> <span class="number">0000</span> <span class="number">2001</span> <span class="number">0000</span> <span class="number">0500</span> <span class="number">0000</span>  <span class="number">4.</span>.. ... .......</span><br><span class="line"><span class="number">00000050</span>: <span class="number">0400</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">0300</span> <span class="number">0000</span> <span class="number">5401</span> <span class="number">0000</span> <span class="number">5481</span> <span class="number">0408</span>  ........T...T...</span><br><span class="line"><span class="number">00000060</span>: <span class="number">5481</span> <span class="number">0408</span> <span class="number">1300</span> <span class="number">0000</span> <span class="number">1300</span> <span class="number">0000</span> <span class="number">0400</span> <span class="number">0000</span>  T...............</span><br><span class="line"><span class="number">00000070</span>: <span class="number">0100</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">0100</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0080</span> <span class="number">0408</span>  ................</span><br><span class="line"><span class="number">00000080</span>: <span class="number">0080</span> <span class="number">0408</span> <span class="number">8805</span> <span class="number">0000</span> <span class="number">8805</span> <span class="number">0000</span> <span class="number">0500</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000090</span>: <span class="number">0010</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">0100</span> <span class="number">0000</span> <span class="number">080f</span> <span class="number">0000</span> <span class="number">089f</span> <span class="number">0408</span>  ................</span><br><span class="line"><span class="number">000000</span>a0: <span class="number">089f</span> <span class="number">0408</span> <span class="number">6901</span> <span class="number">0000</span> <span class="number">6</span>c01 <span class="number">0000</span> <span class="number">0600</span> <span class="number">0000</span>  ....i...l.......</span><br><span class="line"><span class="number">000000b</span>0: <span class="number">0010</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">0200</span> <span class="number">0000</span> <span class="number">140f</span> <span class="number">0000</span> <span class="number">149f</span> <span class="number">0408</span>  ................</span><br><span class="line"><span class="number">000000</span>c0: <span class="number">149f</span> <span class="number">0408</span> e800 <span class="number">0000</span> e800 <span class="number">0000</span> <span class="number">0600</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">000000</span>d0: <span class="number">0400</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">0400</span> <span class="number">0000</span> <span class="number">6801</span> <span class="number">0000</span> <span class="number">6881</span> <span class="number">0408</span>  ........h...h...</span><br><span class="line"><span class="number">000000e0</span>: <span class="number">6881</span> <span class="number">0408</span> <span class="number">4400</span> <span class="number">0000</span> <span class="number">4400</span> <span class="number">0000</span> <span class="number">0400</span> <span class="number">0000</span>  h...D...D.......</span><br><span class="line"><span class="number">000000f</span>0: <span class="number">0400</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">50e5</span> <span class="number">7464</span> <span class="number">9004</span> <span class="number">0000</span> <span class="number">9084</span> <span class="number">0408</span>  ....P.td........</span><br><span class="line"><span class="number">00000100</span>: <span class="number">9084</span> <span class="number">0408</span> <span class="number">2</span>c00 <span class="number">0000</span> <span class="number">2</span>c00 <span class="number">0000</span> <span class="number">0400</span> <span class="number">0000</span>  ....,...,.......</span><br><span class="line"><span class="number">00000110</span>: <span class="number">0400</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">51e5</span> <span class="number">7464</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ....Q.td........		<span class="comment">//GNU_STACK，将对应的0700改为0600后，程序</span></span><br><span class="line"><span class="number">00000120</span>: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0700</span> <span class="number">0000</span>  ................		<span class="comment">//打开NX保护，栈不可执行</span></span><br><span class="line"><span class="number">00000130</span>: <span class="number">1000</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">52e5</span> <span class="number">7464</span> <span class="number">080f</span> <span class="number">0000</span> <span class="number">089f</span> <span class="number">0408</span>  ....R.td........</span><br><span class="line"><span class="number">00000140</span>: <span class="number">089f</span> <span class="number">0408</span> f800 <span class="number">0000</span> f800 <span class="number">0000</span> <span class="number">0400</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">00000150</span>: <span class="number">0100</span> <span class="number">0000</span> </span><br><span class="line">                    <span class="number">2f</span>6c <span class="number">6962</span> <span class="number">2f</span>6c <span class="number">642</span>d <span class="number">6</span>c69 <span class="number">6e75</span>  ..../lib/ld-linu</span><br><span class="line"><span class="number">00000160</span>: <span class="number">782</span>e <span class="number">736f</span> <span class="number">2e32</span> <span class="number">0000</span> <span class="number">0400</span> <span class="number">0000</span> <span class="number">1000</span> <span class="number">0000</span>  x.so<span class="number">.2</span>..........</span><br><span class="line"><span class="number">00000170</span>: <span class="number">0100</span> <span class="number">0000</span> <span class="number">474</span>e <span class="number">5500</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0200</span> <span class="number">0000</span>  ....GNU.........</span><br><span class="line"><span class="number">00000180</span>: <span class="number">0600</span> <span class="number">0000</span> <span class="number">2000</span> <span class="number">0000</span> <span class="number">0400</span> <span class="number">0000</span> <span class="number">1400</span> <span class="number">0000</span>  .... ...........</span><br><span class="line"><span class="number">00000190</span>: <span class="number">0300</span> <span class="number">0000</span> <span class="number">474</span>e <span class="number">5500</span> <span class="number">5915</span> <span class="number">9255</span> <span class="number">2338</span> <span class="number">74b</span>2  ....GNU.Y..U#<span class="number">8</span>t.</span><br><span class="line"><span class="number">000001</span>a0: <span class="number">8b</span>23 <span class="number">9</span>ecd <span class="number">43</span>ea <span class="number">0e25</span> <span class="number">0498</span> cc46 <span class="number">0200</span> <span class="number">0000</span>  .#..C..%...F....</span><br><span class="line"><span class="number">000001b</span>0: <span class="number">0300</span> <span class="number">0000</span> <span class="number">0100</span> <span class="number">0000</span> <span class="number">0500</span> <span class="number">0000</span> <span class="number">0020</span> <span class="number">0020</span>  ............. . </span><br><span class="line"><span class="number">000001</span>c0: <span class="number">0000</span> <span class="number">0000</span> <span class="number">0300</span> <span class="number">0000</span> ad4b e3c0 <span class="number">0000</span> <span class="number">0000</span>  .........K......</span><br></pre></td></tr></table></figure>

<ul>
<li>修改后</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~ <span class="meta"># checksec test</span></span><br><span class="line">[*] '/root/test'</span><br><span class="line">    Arch:     i386<span class="number">-32</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x8048000</span>)</span></span></span><br></pre></td></tr></table></figure>

<h3 id="四、ELF文件格式简图"><a href="#四、ELF文件格式简图" class="headerlink" title="四、ELF文件格式简图"></a>四、ELF文件格式简图</h3><p><img src="https://raw.githubusercontent.com/corkami/pics/28cb0226093ed57b348723bc473cea0162dad366/binary/elf101/elf101.svg" alt="ELF文件格式简图"></p>
<p><img src="/2020/08/08/%E6%89%93%E5%BC%80%E3%80%81%E5%85%B3%E9%97%AD%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%20NX%20%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD/elf32_bit.svg" alt="ELF文件格式简图"></p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ol>
<li><a href="https://github.com/corkami/pics/tree/28cb0226093ed57b348723bc473cea0162dad366/binary/elf101" target="_blank" rel="noopener">https://github.com/corkami/pics/tree/28cb0226093ed57b348723bc473cea0162dad366/binary/elf101</a></li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/07/21/Detect_a_use_after_free_vulnerability/" rel="next" title="Detect a use after free vulnerability">
                <i class="fa fa-chevron-left"></i> Detect a use after free vulnerability
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/21/More%20Efficient%20Instruction%20Counting%20/" rel="prev" title="五、More Efficient Instruction Counting (Trace Instrumentation)">
                五、More Efficient Instruction Counting (Trace Instrumentation) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zyt</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#打开、关闭二进制文件的-NX-保护措施"><span class="nav-number">1.</span> <span class="nav-text">打开、关闭二进制文件的 NX 保护措施</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、-checksec中检查-NX-的代码部分"><span class="nav-number">1.1.</span> <span class="nav-text">一、 checksec中检查 NX 的代码部分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、Program-header"><span class="nav-number">1.2.</span> <span class="nav-text">二、Program header</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、修改实例"><span class="nav-number">1.3.</span> <span class="nav-text">三、修改实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、ELF文件格式简图"><span class="nav-number">1.4.</span> <span class="nav-text">四、ELF文件格式简图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考链接"><span class="nav-number">1.5.</span> <span class="nav-text">参考链接</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zyt</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
