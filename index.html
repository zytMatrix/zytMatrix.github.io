<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Matrix">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Matrix">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zyt">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Matrix</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Matrix</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/11/MacOS%E4%B8%8B%E9%85%8D%E7%BD%AELatex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zyt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Matrix">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/11/MacOS%E4%B8%8B%E9%85%8D%E7%BD%AELatex/" itemprop="url">macOS é…ç½® LaTeXï¼ˆMacTeX + VSCode + Skimï¼‰</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-11T11:33:09+08:00">
                2020-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Latex/" itemprop="url" rel="index">
                    <span itemprop="name">Latex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä¸€ã€å®‰è£…å‡†å¤‡"><a href="#ä¸€ã€å®‰è£…å‡†å¤‡" class="headerlink" title="ä¸€ã€å®‰è£…å‡†å¤‡"></a>ä¸€ã€å®‰è£…å‡†å¤‡</h2><h3 id="1-å®‰è£…-MacTeX"><a href="#1-å®‰è£…-MacTeX" class="headerlink" title="1 å®‰è£… MacTeX"></a>1 å®‰è£… MacTeX</h3><p>ä» <a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.tug.org%2Fmactex%2Fmactex-download.html" target="_blank" rel="noopener">Downloading MacTeX 2019 </a>ä¸­ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ MacTeX å¹¶å®‰è£…ã€‚</p>
<h3 id="2-å®‰è£…-VSCode-åŠç›¸å…³æ’ä»¶"><a href="#2-å®‰è£…-VSCode-åŠç›¸å…³æ’ä»¶" class="headerlink" title="2 å®‰è£… VSCode åŠç›¸å…³æ’ä»¶"></a>2 å®‰è£… VSCode åŠç›¸å…³æ’ä»¶</h3><p>ä» <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fcode.visualstudio.com%2Fdownload" target="_blank" rel="noopener">Download Visual Studio Code</a> ä¸­ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ VSCode å¹¶å®‰è£…ã€‚æ‰“å¼€ VSCodeï¼Œåœ¨ <code>Extensions</code> æœç´¢æ¡†ä¸­è¾“å…¥ LaTeX, é€‰æ‹© <code>LaTeX WorkShop</code> æ’ä»¶å¹¶å®‰è£…ã€‚æœ¬æ¬¡æµ‹è¯•VSCodeç‰ˆæœ¬ä¿¡æ¯ï¼š<code>Version: 1.47.0-insider</code></p>
<h2 id="äºŒã€LaTeX-WorkShop-æ’ä»¶é…ç½®ä¸­æ–‡ç¯å¢ƒ"><a href="#äºŒã€LaTeX-WorkShop-æ’ä»¶é…ç½®ä¸­æ–‡ç¯å¢ƒ" class="headerlink" title="äºŒã€LaTeX WorkShop æ’ä»¶é…ç½®ä¸­æ–‡ç¯å¢ƒ"></a>äºŒã€LaTeX WorkShop æ’ä»¶é…ç½®ä¸­æ–‡ç¯å¢ƒ</h2><p>LaTeX WorkShop æ’ä»¶é»˜è®¤åªæä¾›<code>PDFLaTeX</code>ï¼Œè€Œä¸­æ–‡ç¼–è¯‘éœ€è¦<code>XeFLaTeX</code>ï¼Œæ‰€ä»¥è¿˜éœ€å¦è¡Œé…ç½®ã€‚è¿›å…¥ Settings çš„ JSON æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹é…ç½®ï¼š</p>
<ol>
<li><p>åœ¨latex-workshop.latex.toolsé…ç½®ä¸­ï¼Œå¢åŠ xelatexé¡¹ï¼Œå…·ä½“å¦‚ä¸‹ã€‚è¿™ä¸€é¡¹çš„ä½œç”¨æ˜¯åœ¨å·¥å…·é›†ä¸­å®šä¹‰xelatexé¡¹ï¼Œä»¥ä¾¿ä¸‹ä¸€é¡¹é…ç½®èƒ½æ‰¾åˆ°ã€‚åœ¨settingæœç´¢æ¡†ä¸­æœç´¢<code>latex-workshop.latex.tools</code>ï¼Œæ‰“å¼€è¿›è¡Œç¼–è¾‘</p>
<p>![image-20200711114101327](/Users/zyt/Library/Application Support/typora-user-images/image-20200711114101327.png)</p>
<p>å¢åŠ çš„å†…å®¹ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"xelatex"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"xelatex"</span>,</span><br><span class="line">    <span class="attr">"args"</span>: [</span><br><span class="line">        <span class="string">"-synctex=1"</span>,</span><br><span class="line">        <span class="string">"-interaction=nonstopmode"</span>,</span><br><span class="line">        <span class="string">"-file-line-error"</span>,</span><br><span class="line">        <span class="string">"-pdf"</span>,</span><br><span class="line">        <span class="string">"%DOC%"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>åœ¨latex-workshop.latex.recipesé…ç½®ä¸­ï¼Œå°†ç¬¬ä¸€é¡¹çš„latexmkæ”¹ä¸ºxelatexã€‚è¿™é‡Œå®šä¹‰çš„æ˜¯ç¼–è¯‘æ—¶è°ƒç”¨çš„å·¥å…·é¡ºåºï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªä¸ºlatexmkï¼Œå› ä¸ºæˆ‘ä»¬è¦æ”¯æŒä¸­æ–‡ï¼Œæ‰€ä»¥æ›¿æ¢ä¸ºxelatexã€‚åœ¨settingæœç´¢æ¡†ä¸­æœç´¢<code>latex-workshop.latex.tools</code>ï¼Œæ‰“å¼€è¿›è¡Œç¼–è¾‘ï¼š</p>
<p>![image-20200711114358156](/Users/zyt/Library/Application Support/typora-user-images/image-20200711114358156.png)</p>
<p>å¢åŠ çš„å†…å®¹ä¸ºï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"xelatex"</span>,</span><br><span class="line">    <span class="attr">"tools"</span>: [</span><br><span class="line">    		<span class="string">"xelatex"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹åçš„<code>settings.json</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"editor.fontSize"</span>: <span class="number">13</span>,</span><br><span class="line">    <span class="attr">"workbench.startupEditor"</span>: <span class="string">"newUntitledFile"</span>,</span><br><span class="line">    <span class="attr">"editor.renderControlCharacters"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"files.autoSave"</span>: <span class="string">"off"</span>,</span><br><span class="line">    <span class="attr">"python.analysis.memory.keepLibraryLocalVariables"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"window.zoomLevel"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"latex-workshop.latex.tools"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"xelatex"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"xelatex"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-synctex=1"</span>,</span><br><span class="line">                <span class="string">"-interaction=nonstopmode"</span>,</span><br><span class="line">                <span class="string">"-file-line-error"</span>,</span><br><span class="line">                <span class="string">"-pdf"</span>,</span><br><span class="line">                <span class="string">"%DOC%"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"latexmk"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"latexmk"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-synctex=1"</span>,</span><br><span class="line">                <span class="string">"-interaction=nonstopmode"</span>,</span><br><span class="line">                <span class="string">"-file-line-error"</span>,</span><br><span class="line">                <span class="string">"-pdf"</span>,</span><br><span class="line">                <span class="string">"-outdir=%OUTDIR%"</span>,</span><br><span class="line">                <span class="string">"%DOC%"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"env"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"lualatexmk"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"latexmk"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-synctex=1"</span>,</span><br><span class="line">                <span class="string">"-interaction=nonstopmode"</span>,</span><br><span class="line">                <span class="string">"-file-line-error"</span>,</span><br><span class="line">                <span class="string">"-lualatex"</span>,</span><br><span class="line">                <span class="string">"-outdir=%OUTDIR%"</span>,</span><br><span class="line">                <span class="string">"%DOC%"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"env"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"latexmk_rconly"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"latexmk"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"%DOC%"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"env"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"pdflatex"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"pdflatex"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-synctex=1"</span>,</span><br><span class="line">                <span class="string">"-interaction=nonstopmode"</span>,</span><br><span class="line">                <span class="string">"-file-line-error"</span>,</span><br><span class="line">                <span class="string">"%DOC%"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"env"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"bibtex"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"bibtex"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"%DOCFILE%"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"env"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"rnw2tex"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"Rscript"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-e"</span>,</span><br><span class="line">                <span class="string">"knitr::opts_knit$set(concordance = TRUE); knitr::knit('%DOCFILE_EXT%')"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"env"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"jnw2tex"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"julia"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-e"</span>,</span><br><span class="line">                <span class="string">"using Weave; weave(\"%DOC_EXT%\", doctype=\"tex\")"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"env"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"jnw2texmintex"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"julia"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"-e"</span>,</span><br><span class="line">                <span class="string">"using Weave; weave(\"%DOC_EXT%\", doctype=\"texminted\")"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"env"</span>: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"latex-workshop.latex.recipes"</span>: [  </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"xelatex"</span>,</span><br><span class="line">            <span class="attr">"tools"</span>: [</span><br><span class="line">                <span class="string">"xelatex"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"latexmk ğŸ”ƒ"</span>,</span><br><span class="line">            <span class="attr">"tools"</span>: [</span><br><span class="line">                <span class="string">"latexmk"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"latexmk (latexmkrc)"</span>,</span><br><span class="line">            <span class="attr">"tools"</span>: [</span><br><span class="line">                <span class="string">"latexmk_rconly"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"latexmk (lualatex)"</span>,</span><br><span class="line">            <span class="attr">"tools"</span>: [</span><br><span class="line">                <span class="string">"lualatexmk"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"pdflatex â bibtex â pdflatexâ€ŠÃ—â€Š2"</span>,</span><br><span class="line">            <span class="attr">"tools"</span>: [</span><br><span class="line">                <span class="string">"pdflatex"</span>,</span><br><span class="line">                <span class="string">"bibtex"</span>,</span><br><span class="line">                <span class="string">"pdflatex"</span>,</span><br><span class="line">                <span class="string">"pdflatex"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Compile Rnw files"</span>,</span><br><span class="line">            <span class="attr">"tools"</span>: [</span><br><span class="line">                <span class="string">"rnw2tex"</span>,</span><br><span class="line">                <span class="string">"latexmk"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Compile Jnw files"</span>,</span><br><span class="line">            <span class="attr">"tools"</span>: [</span><br><span class="line">                <span class="string">"jnw2tex"</span>,</span><br><span class="line">                <span class="string">"latexmk"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºä¸€ä¸ª.texæ–‡ä»¶ï¼Œç¼–ç ä¸ºutf8ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ã€‚ä¿å­˜ï¼Œ<code>option + command + B</code>ç¼–è¯‘ï¼Œè‡ªåŠ¨ç¼–è¯‘äº§ç”Ÿå¯¹åº”çš„pdfã€‚</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">documentclass</span><span class="string">[UTF8]</span><span class="string">&#123;ctexart&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">title</span><span class="string">&#123;ä½ å¥½ï¼Œworld!&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">author</span><span class="string">&#123;ææ˜&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">date</span><span class="string">&#123;\today&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;document&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">maketitle</span></span></span><br><span class="line">ä½ å¥½ï¼Œworld!</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;document&#125;</span></span></span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœä¸ºï¼š</p>
<p>![image-20200711115109103](/Users/zyt/Library/Application Support/typora-user-images/image-20200711115109103.png)</p>
</li>
</ol>
<h2 id="ä¸‰ã€é…ç½®VSCodeä¸Skimçš„LaTeXæ­£åè·³è½¬"><a href="#ä¸‰ã€é…ç½®VSCodeä¸Skimçš„LaTeXæ­£åè·³è½¬" class="headerlink" title="ä¸‰ã€é…ç½®VSCodeä¸Skimçš„LaTeXæ­£åè·³è½¬"></a>ä¸‰ã€é…ç½®VSCodeä¸Skimçš„LaTeXæ­£åè·³è½¬</h2><ol>
<li>å®‰è£… <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fskim-app.sourceforge.io%2F" target="_blank" rel="noopener">Skim</a> PDF é˜…è¯»å™¨</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install skim</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ­£å‘è·³è½¬</li>
</ol>
<p>æ­£å‘è·³è½¬æŒ‡çš„æ˜¯ä» .tex æºæ–‡ä»¶å‘ç¼–è¯‘ç”Ÿæˆçš„ PDF æ–‡ä»¶çš„è·³è½¬ã€‚è¿™éƒ¨åˆ†æˆ‘ä»¬ä¸»è¦éœ€è¦å¯»æ‰¾åˆ°åˆé€‚çš„æ–¹å¼ï¼Œåœ¨å‘½ä»¤è¡ŒçŠ¶æ€æ‰“å¼€ Skim åº”ç”¨ã€‚</p>
<p>æ ¹æ® Skim å®˜ç½‘çš„ä»‹ç»ï¼ŒSkim æä¾›äº†åä¸º displayline çš„è„šæœ¬ï¼Œç”¨äºå’Œ TeX æ­£ååŒæ­¥ååŒå·¥ä½œã€‚å…¶è„šæœ¬ä½äº:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Applications&#x2F;Skim.app&#x2F;Contents&#x2F;SharedSupport&#x2F;displayline</span><br></pre></td></tr></table></figure>

<p>å…·ä½“ç”¨æ³•æ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Applications&#x2F;Skim.app&#x2F;Contents&#x2F;SharedSupport&#x2F;displayline %line &quot;%pdffile&quot; &quot;%texfile&quot;</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„ <strong><code>%line</code></strong> è¡¨ç¤º <strong><code>.tex</code></strong> æ–‡ä»¶çš„è¡Œå·ï¼Œ<strong><code>%pdffile</code></strong> è¡¨ç¤ºç¼–è¯‘ç”Ÿæˆçš„ PDF æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œ<strong><code>%texfile</code></strong>åˆ™æ˜¯å¯¹åº”çš„ .tex æºæ–‡ä»¶ã€‚è€ƒè™‘åˆ°æˆ‘ä»¬å¯¹åå‘æœç´¢ä¹Ÿæœ‰éœ€æ±‚ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŠ ä¸Š<strong><code>-r</code></strong>å‚æ•°ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ VSCode çš„é…ç½®é‡Œï¼Œæˆ‘ä»¬éœ€è¦ç»™å‡ºè¿™æ ·çš„ <strong><code>JSON é…ç½®</code></strong>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">"latex-workshop.view.pdf.viewer": "external",</span><br><span class="line">"latex-workshop.view.pdf.external.synctex": &#123;</span><br><span class="line">    "command": "/Applications/Skim.app/Contents/SharedSupport/displayline",</span><br><span class="line">    "args": [</span><br><span class="line">        "-r",</span><br><span class="line">        "%LINE%",</span><br><span class="line">        "%PDF%",</span><br><span class="line">        <span class="string">"%TEX%"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong><code>LaTeX workshop</code></strong>æ’ä»¶çš„é…ç½®ä¸­ï¼Œé™¤äº† <strong><code>latex-workshop.view.pdf.external.synctex</code></strong>ï¼Œè¿˜æœ‰ä¸€é¡¹ä¹Ÿå’Œæ‰“å¼€å¤–éƒ¨ PDF æµè§ˆå™¨æœ‰å…³ã€‚å®ƒæ˜¯ <strong><code>latex-workshop.view.pdf.external.command</code></strong>ï¼Œè¡¨ç¤ºç®€å•åœ°æ‰“å¼€ PDF æ–‡ä»¶ï¼Œè€Œå¿½ç•¥æ­£å‘æœç´¢åŠŸèƒ½ã€‚<strong><code>Skim</code></strong>æä¾›çš„å‘½ä»¤è¡Œè„šæœ¬é»˜è®¤ä¸æ”¯æŒè¿™æ ·çš„æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®<strong><code>displayline</code></strong>è„šæœ¬è‡ªè¡Œä¿®æ”¹ã€‚</p>
<p><strong><code>displayline</code></strong>è„šæœ¬è°ƒç”¨äº† <strong><code>Apple Script</code></strong> æ¥å®ç°ä¸ <strong><code>Skim.app</code></strong> çš„äº¤äº’ï¼Œæ­¤å¤„æˆ‘ä»¬ç…§è‘«èŠ¦ç”»ç“¢ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªå³å¯ã€‚æˆ‘ä»¬å¯ä»¥å°†å¦‚ä¸‹è„šæœ¬ä¿å­˜ä¸º <strong><code>displayfile</code></strong> å¹¶ä»¥ <strong><code>chmod u+x displayfile</code></strong> ä½¿å…¶å˜ä¸ºå¯æ‰§è¡Œè„šæœ¬ï¼Œè€Œåå°†å…¶æ”¾åœ¨<strong><code>ç¯å¢ƒå˜é‡ PATH</code></strong> åŒ…å«çš„ç›®å½•ä¸­ï¼Œå¦‚ï¼š<code>/usr/local/bin</code>ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># displayfile (Skim)</span><br><span class="line">#</span><br><span class="line"># Usage: displayfile [-r] [-g] PDFFILE</span><br><span class="line">#</span><br><span class="line"># Modified from "displayline" to only revert the file, not jump to a given line</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">if [ $# == 0 -o "$1" == "-h" -o "$1" == "-help" ]; then</span><br><span class="line">  echo "Usage: displayfile [-r] [-g] PDFFILE</span><br><span class="line">Options:</span><br><span class="line">-r, -revert      Revert the file from disk if it was open</span><br><span class="line">-g, -background  Do not bring Skim to the foreground"</span><br><span class="line">  exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># get arguments</span><br><span class="line">revert=false</span><br><span class="line">activate=true</span><br><span class="line">while [ "$&#123;1:0:1&#125;" == "-" ]; do</span><br><span class="line">  if [ "$1" == "-r" -o "$1" == "-revert" ]; then</span><br><span class="line">    revert=true</span><br><span class="line">  elif [ "$1" == "-g" -o "$1" == "-background" ]; then</span><br><span class="line">    activate=false</span><br><span class="line">  fi</span><br><span class="line">  shift</span><br><span class="line">done</span><br><span class="line">file="$1"</span><br><span class="line">#shopt -s extglob</span><br><span class="line">#[ $# -gt 2 ] &amp;&amp; source="$3" || source="$&#123;file%.@(pdf|dvi|xdv)&#125;.tex"</span><br><span class="line"></span><br><span class="line"># expand relative paths</span><br><span class="line">[ "$&#123;file:0:1&#125;" == "/" ] || file="$&#123;PWD&#125;/$&#123;file&#125;"</span><br><span class="line"></span><br><span class="line"># pass file arguments as NULL-separated string to osascript</span><br><span class="line"># pass through cat to get them as raw bytes to preserve non-ASCII characters</span><br><span class="line">/usr/bin/osascript \</span><br><span class="line">  -e "set theFile to POSIX file \"$file\"" \</span><br><span class="line">  -e "set thePath to POSIX path of (theFile as alias)" \</span><br><span class="line">  -e "tell application \"Skim\"" \</span><br><span class="line">  -e "  if $activate then activate" \</span><br><span class="line">  -e "  if $revert then" \</span><br><span class="line">  -e "    try" \</span><br><span class="line">  -e "      set theDocs to get documents whose path is thePath" \</span><br><span class="line">  -e "      if (count of theDocs) &gt; 0 then revert theDocs" \</span><br><span class="line">  -e "    end try" \</span><br><span class="line">  -e "  end if" \</span><br><span class="line">  -e "  open theFile" \</span><br><span class="line">  -e "end tell"</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œéœ€è¦æ›´æ–° VSCode çš„é…ç½®ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">"latex-workshop.view.pdf.external.command": &#123;</span><br><span class="line">    "command": "displayfile",</span><br><span class="line">    "args": [</span><br><span class="line">        "-r",</span><br><span class="line">        <span class="string">"%PDF%"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>é…ç½®å®Œæˆå,å¯ä»¥ä» TeX æºç è·³è½¬åˆ° Skim ä¸­å¯¹åº”çš„ PDF æ–‡ä»¶ä½ç½®(æœ‰åœ†ç‚¹é†’ç›®ä½ç½®æé†’)ï¼Œå¿«æ·é”®ä¸º: <code>option+command+j</code> ï¼›</strong></p>
<h3 id="åå‘æœç´¢"><a href="#åå‘æœç´¢" class="headerlink" title="åå‘æœç´¢"></a>åå‘æœç´¢</h3><p>åœ¨åå‘æœç´¢ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®© Skim èƒ½å¤Ÿæ‰“å¼€ VSCodeï¼Œå¹¶å°†æ–‡ä»¶åå’Œç›¸åº”çš„è¡Œå·æ­£ç¡®åœ°ä¼ ç»™ VSCodeã€‚æ ¹æ® Skim å®˜ç½‘çš„ä»‹ç»ï¼Œå®ƒåªä¼šä»<strong><code>/usr/bin</code></strong>å’Œ <strong><code>/usr/local/bin</code></strong> ä¸­æ£€ç´¢å¯æ‰§è¡Œç¨‹åºã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°† VSCode çš„å¯æ‰§è¡Œç¨‹åºè½¯é“¾åˆ°è¿™ä¸¤ä¸ªç›®å½•ä¸­çš„ä¸€ä¸ªå½“ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf &#x2F;Applications&#x2F;Visual\ Studio\ Code.app&#x2F;Contents&#x2F;MacOS&#x2F;Electron &#x2F;usr&#x2F;local&#x2F;bin&#x2F;vscode</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ <strong><code>vscode -g &quot;%file&quot;:%line</code></strong> å³å¯æ‰“å¼€ <strong><code>%file</code></strong> æ–‡ä»¶å¹¶å®šä½åˆ°ç¬¬ <strong><code>%line</code></strong> è¡Œã€‚äºæ˜¯ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ Skim çš„åŒæ­¥é…ç½®ä¸­å°†é¢„è®¾æ”¹ä¸ºã€Œè‡ªå®šä¹‰ã€(å¿…é¡»æ”¹ä¸ºè‡ªåŠ¨ä»¥æ‰å¯ä»¥ä½¿ç”¨åå‘è·³è½¬)ï¼Œå¹¶å°†å‘½ä»¤å’Œå‚æ•°åˆ†åˆ«è®¾ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Command: vscode</span><br><span class="line">Arguments: -g &quot;%file&quot;:%line</span><br></pre></td></tr></table></figure>

<img src="/Users/zyt/Library/Application Support/typora-user-images/image-20200711115731991.png" alt="image-20200711115731991" style="zoom:50%;" />

<p>å¦‚æ­¤å³å®Œæˆäº†é…ç½®ã€‚</p>
<p><strong>åœ¨ Skim ä¸­è·³è½¬åˆ°TeXæºç å¯¹åº”çš„ä½ç½®çš„å¿«æ·é”®: <code>command + shift + click</code></strong></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol>
<li><a href="https://www.jianshu.com/p/4aee83e66ab8" target="_blank" rel="noopener">https://www.jianshu.com/p/4aee83e66ab8</a></li>
<li><a href="https://www.jianshu.com/p/29adf0eadd30" target="_blank" rel="noopener">https://www.jianshu.com/p/29adf0eadd30</a></li>
<li><a href="https://liam.page/2018/04/24/Working-with-VSCode-on-macOS-configuration-LaTeX-workshop-and-Skim/" target="_blank" rel="noopener">https://liam.page/2018/04/24/Working-with-VSCode-on-macOS-configuration-LaTeX-workshop-and-Skim/</a></li>
</ol>
<h2 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h2><p>1.<a href="https://zhuanlan.zhihu.com/p/108095566" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/108095566</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/10/REX%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zyt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Matrix">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/10/REX%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%B5%81%E7%A8%8B/" itemprop="url">REXæ¼æ´åˆ©ç”¨æµç¨‹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-10T12:21:31+08:00">
                2020-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rex/" itemprop="url" rel="index">
                    <span itemprop="name">Rex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ä¸€ã€crashåˆ†æ"><a href="#ä¸€ã€crashåˆ†æ" class="headerlink" title="ä¸€ã€crashåˆ†æ"></a>ä¸€ã€crashåˆ†æ</h2><h3 id="è·¯å¾„é‡ç°ï¼ˆæ”¶é›†traceï¼‰"><a href="#è·¯å¾„é‡ç°ï¼ˆæ”¶é›†traceï¼‰" class="headerlink" title="è·¯å¾„é‡ç°ï¼ˆæ”¶é›†traceï¼‰"></a>è·¯å¾„é‡ç°ï¼ˆæ”¶é›†traceï¼‰</h3><ol>
<li>åˆ©ç”¨QEMUå…·ä½“åŒ–æ‰§è¡Œè·å–åŸºæœ¬å—æ‰§è¡Œåºåˆ—ï¼štarce</li>
<li>åˆ©ç”¨traceå¼•å¯¼angrè¿›è¡Œç¬¦å·æ‰§è¡Œï¼Œæ”¶é›†è·¯å¾„çº¦æŸï¼Œåˆ°è¾¾å´©æºƒæ—¶è®°å½•å´©æºƒçš„ State å’Œå‰ä¸€ä¸ª State</li>
</ol>
<h3 id="ç¬¦å·åŒ–å†…å­˜å†™"><a href="#ç¬¦å·åŒ–å†…å­˜å†™" class="headerlink" title="ç¬¦å·åŒ–å†…å­˜å†™"></a>ç¬¦å·åŒ–å†…å­˜å†™</h3><p>ç¬¦å·æ‰§è¡Œä¸­æ”¶é›†æ‰€æœ‰å¯ä»¥ç¬¦å·åŒ–å†…å­˜å†™çš„åœ°å€ï¼Œä¸ºåé¢åˆ©ç”¨æ—¶å¸ƒç½®shellcodeåšå‡†å¤‡</p>
<h3 id="æ¼æ´åˆ†ç±»"><a href="#æ¼æ´åˆ†ç±»" class="headerlink" title="æ¼æ´åˆ†ç±»"></a>æ¼æ´åˆ†ç±»</h3><ol>
<li><p>ip æ˜¯å¦ç¬¦å·åŒ–ï¼Œå¹¶æ ¹æ®å¯æ§çš„å¤§å°å°†æ¼æ´åˆ†ä¸º IP_OVERWRITE / PARTIAL_IP_OVERWRITEã€‚</p>
</li>
<li><p>bp æ˜¯å¦ç¬¦å·åŒ–ï¼Œå¹¶æ ¹æ®å¯æ§çš„å¤§å°å°†æ¼æ´åˆ¤å®šä¸º BP_OVERWRITE / PARTIAL_BP_OVERWRITE</p>
</li>
<li><p>æ£€æŸ¥å´©æºƒæ—¶å‰ä¸€ä¸ª Stateï¼Œç­›é€‰å‡ºå¯ä»¥æ§åˆ¶å†…å­˜è¯»ã€å†™ç›®æ ‡åœ°å€çš„æ“ä½œï¼š</p>
<ul>
<li><p>å¦‚æœç¬¦å·åŒ–æ“ä½œä¸­æœ‰å†…å­˜å†™ï¼Œæ ¹æ®å†™çš„å†…å®¹æ˜¯å¦å¯æ§å°†æ¼æ´åˆ¤å®šä¸º WRITE_WHAT_WHERE / WRITE_X_WHERE ã€‚</p>
</li>
<li><p>å¦‚æœç¬¦å·åŒ–æ“ä½œä¸­æœ‰å†…å­˜è¯»ï¼Œå°†æ¼æ´åˆ¤å®šä¸º ARBITRARY_READ ã€‚</p>
</li>
</ul>
</li>
</ol>
<h2 id="äºŒã€å¯åˆ©ç”¨æ€§åˆ¤æ–­"><a href="#äºŒã€å¯åˆ©ç”¨æ€§åˆ¤æ–­" class="headerlink" title="äºŒã€å¯åˆ©ç”¨æ€§åˆ¤æ–­"></a>äºŒã€å¯åˆ©ç”¨æ€§åˆ¤æ–­</h2><p>èƒ½è¢«åˆ©ç”¨çš„æ¼æ´ç±»å‹æœ‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exploitables &#x3D; [Vulnerability.IP_OVERWRITE, Vulnerability.PARTIAL_IP_OVERWRITE, Vulnerability.BP_OVERWRITE,</span><br><span class="line">            Vulnerability.PARTIAL_BP_OVERWRITE, Vulnerability.WRITE_WHAT_WHERE, Vulnerability.WRITE_X_WHERE]</span><br></pre></td></tr></table></figure>

<p>è‹¥å´©æºƒæ—¶å±äºå…¶ä¸­çš„ç±»å‹åˆ™å¯ä»¥è¢«åˆ©ç”¨ï¼Œä½†æ˜¯åœ¨REXç°æœ‰çš„åˆ©ç”¨æŠ€æœ¯ä¸­ï¼Œä»…å½“æ»¡è¶³<code>IP_OVERWRITEã€PARTIAL_IP_OVERWRITE</code>æ—¶å€™ï¼Œæ‰å¯ä»¥è¿›è¡Œåˆ©ç”¨ã€‚è‹¥æ¼æ´ç±»å‹æ˜¯<code>WRITE_WHAT_WHEREã€WRITE_X_WHEREã€ARBITRARY_READ</code>ï¼Œå¯ä»¥è°ƒç”¨å‡½æ•°<code>explore</code>å¯¹å½“å‰æ¼æ´å†æ¬¡è¿›è¡Œæ¢ç´¢ï¼Œçœ‹æœ€ç»ˆèƒ½å¦æ§åˆ¶<code>ip</code>ã€‚</p>
<h2 id="ä¸‰ã€è¿›è¡Œåˆ©ç”¨"><a href="#ä¸‰ã€è¿›è¡Œåˆ©ç”¨" class="headerlink" title="ä¸‰ã€è¿›è¡Œåˆ©ç”¨"></a>ä¸‰ã€è¿›è¡Œåˆ©ç”¨</h2><p>åœ¨Rexä¸­ï¼Œæ¼æ´åˆ©ç”¨æ‰‹æ®µçš„çˆ¶ç±»æ˜¯ Techniqueï¼Œæ¯ä¸€ç§åˆ©ç”¨æŠ€æœ¯ technique éƒ½æ˜¯å®ƒçš„å­ç±»ï¼Œéœ€è¦å¯¹çˆ¶ç±»ä¸­ checkã€apply è¿™ä¸¤ä¸ªå‡½æ•°è¿›è¡Œé‡å†™ï¼š</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">check: æ£€æŸ¥åˆ©ç”¨æŠ€æœ¯èƒ½å¦åº”ç”¨åˆ° binary ä¸Šï¼Œä¸»è¦æ˜¯åˆ¤æ–­èƒ½å¦æ§åˆ¶ ipï¼ˆå®Œå…¨æ§åˆ¶å’Œéƒ¨åˆ†æ§åˆ¶ï¼‰</span><br><span class="line">apply: å¯¹å´©æºƒæ—¶çš„ state è¿›è¡Œåˆ©ç”¨ï¼ŒæˆåŠŸåˆ™è¿”å› Exploit å¯¹è±¡</span><br></pre></td></tr></table></figure>

<p>ç°æœ‰çš„æ”¯æŒ Linux å¹³å°çš„åˆ©ç”¨æŠ€æœ¯ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åç§°</th>
<th align="left">é™å®šæ¼æ´ç±»å‹</th>
<th align="left">å…¶ä»–æ¡ä»¶</th>
<th align="left">å¹³å°</th>
</tr>
</thead>
<tbody><tr>
<td align="left">call_jmp_sp_shellcode</td>
<td align="left">IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td align="left">æ ˆå¯æ‰§è¡Œ</td>
<td align="left">unix</td>
</tr>
<tr>
<td align="left">call_shellcode</td>
<td align="left">IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td align="left">æ ˆå¯æ‰§è¡Œ</td>
<td align="left">unix</td>
</tr>
<tr>
<td align="left">rop_register_control</td>
<td align="left">IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td align="left"></td>
<td align="left">unix</td>
</tr>
<tr>
<td align="left">rop_to_accept_system</td>
<td align="left">IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td align="left">å­˜åœ¨ accept &amp; readå‡½æ•°</td>
<td align="left">unix</td>
</tr>
<tr>
<td align="left">rop_to_execl</td>
<td align="left">IP_OVERWRITE/ PARTIAL_IP_OVERWRITE</td>
<td align="left">å­˜åœ¨ execl &amp; dup2 å‡½æ•°</td>
<td align="left">unix</td>
</tr>
<tr>
<td align="left">rop_to_system</td>
<td align="left">IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td align="left">å­˜åœ¨ system å‡½æ•°</td>
<td align="left">unix</td>
</tr>
<tr>
<td align="left">rop_to_system_complicated</td>
<td align="left">IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td align="left">libcè¢«åŠ è½½ &amp; system å‡½æ•° &amp; plt</td>
<td align="left">unix</td>
</tr>
</tbody></table>
<p>è¿›è¡Œåˆ©ç”¨æ—¶å€™å¯èƒ½éœ€è¦å®ç°çš„ä¸€äº›å…¬å…±çš„åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>_write_global_data() :</strong> å¯¹æˆ‘ä»¬èƒ½æ§åˆ¶çš„å†…å­˜è¿›è¡Œçº¦æŸæ±‚è§£ï¼Œç›®çš„åœ¨äºåˆ¤æ–­æ˜¯å¦å¯ä»¥å†™å…¥æŒ‡å®šçš„å†…å®¹ï¼Œå¦‚ï¼šgadget</li>
<li><strong>_read_in_global_data()ï¼š</strong>è‹¥ä¸Šè¿°åˆ¤æ–­ä¸ºTrueï¼Œåˆ™æ„å»ºrop_chainå°†æ•°æ®å†™åˆ°ç›¸åº”çš„åœ°å€ï¼š<ul>
<li><strong>_read_in_global_data_with_read(data)ï¼š</strong>è°ƒç”¨readå‡½æ•°ä¸Šä¼ æ•°æ®</li>
<li><strong>_read_in_global_data_with_gets(data)ï¼š</strong>è°ƒç”¨getså‡½æ•°ä¸Šä¼ æ•°æ®</li>
</ul>
</li>
</ul>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote>
<ol>
<li><a href="https://xz.aliyun.com/t/7179" target="_blank" rel="noopener">https://xz.aliyun.com/t/7179</a></li>
</ol>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/09/hexo%E6%B7%BB%E5%8A%A0%E7%9A%84%E5%88%86%E7%B1%BB%E3%80%81%E6%A0%87%E7%AD%BE%E9%A1%B5%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zyt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Matrix">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/09/hexo%E6%B7%BB%E5%8A%A0%E7%9A%84%E5%88%86%E7%B1%BB%E3%80%81%E6%A0%87%E7%AD%BE%E9%A1%B5%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA/" itemprop="url">hexoæ·»åŠ çš„åˆ†ç±»ã€æ ‡ç­¾é¡µæ— æ³•æ˜¾ç¤º</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-09T22:44:32+08:00">
                2020-07-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" itemprop="url" rel="index">
                    <span itemprop="name">Hexoåšå®¢æ­å»º</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-ç‚¹å‡»homeã€tagsç­‰æ˜¾ç¤º404"><a href="#1-ç‚¹å‡»homeã€tagsç­‰æ˜¾ç¤º404" class="headerlink" title="1. ç‚¹å‡»homeã€tagsç­‰æ˜¾ç¤º404"></a>1. ç‚¹å‡»homeã€tagsç­‰æ˜¾ç¤º404</h2><p><strong>urlï¼š</strong><a href="https://zytmatrix.github.io/tags/" target="_blank" rel="noopener">https://zytmatrix.github.io/tags/%20</a></p>
<p>é¡µé¢æ˜¾ç¤ºå†…å®¹ï¼š</p>
<img src="/Users/zyt/Library/Application Support/typora-user-images/image-20200709224900196.png" alt="image-20200709224900196" style="zoom:50%;" />

<p><strong>åŸå› åŠè§£å†³åŠæ³•</strong></p>
<p>åœ¨ä¸»é¢˜çš„é…ç½®æ–‡ä»¶<code>themes/next/_config.yml</code>ä¸­ï¼Œä¸ºäº†æ‰“å¼€<code>homeã€tagsã€categories</code>ç­‰é¡µé¢ï¼Œéœ€è¦å»æ‰å‰é¢çš„æ³¨é‡Šã€‚ä½†æ˜¯åœ¨<code>||</code>å‰é¢æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œæ›´æ–°ååœ¨åšå®¢ä¸­ç‚¹<code>tags</code>ï¼Œæµè§ˆå™¨æ˜¾ç¤º404ä¸”<code>url</code>çš„æœ«å°¾æœ‰ä¸€ä¸ª%20ï¼ˆè¡¨ç¤ºç©ºæ ¼ï¼‰ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦å»æ‰æ‰€æœ‰<code>||</code>å‰é¢çš„ç©ºæ ¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: /|| home</span><br><span class="line">  <span class="comment">#about: /about/ || user ## â€œ||â€å‰é¢æœ‰ä¸ªç©ºæ ¼</span></span><br><span class="line">  tags: /tags/|| tags <span class="comment">## å»æ‰â€œ||â€å‰é¢çš„ç©ºæ ¼</span></span><br><span class="line">  categories: /categories/|| th</span><br><span class="line">  archives: /archives/|| archive</span><br><span class="line">  <span class="comment">#schedule: /schedule/ || calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || sitemap</span></span><br><span class="line">  <span class="comment">#commonweal: /404/ || heartbeat</span></span><br></pre></td></tr></table></figure>

<h2 id="2-åˆ†ç±»ã€æ ‡ç­¾é¡µé¢ä¸æ˜¾ç¤º"><a href="#2-åˆ†ç±»ã€æ ‡ç­¾é¡µé¢ä¸æ˜¾ç¤º" class="headerlink" title="2. åˆ†ç±»ã€æ ‡ç­¾é¡µé¢ä¸æ˜¾ç¤º"></a>2. åˆ†ç±»ã€æ ‡ç­¾é¡µé¢ä¸æ˜¾ç¤º</h2><p>åˆ†åˆ«åœ¨<code>categories/index.mdã€tags/index.md</code>ä¸­æ·»åŠ <code>layout</code>å±æ€§ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">layout: categories <span class="comment">## themes/next/layout/category.swig</span></span><br><span class="line">layout: tags  <span class="comment">## themes/next/layout/tag.swig</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>layout</code>çš„å€¼æ¥è‡ªäºå¯¹åº”ä¸»é¢˜ç›®å½•<code>layout</code>ä¸‹çš„å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls themes/next/layout/</span><br><span class="line">_custom       _macro        _scripts      archive.swig  index.swig    post.swig     tag.swig</span><br><span class="line">_layout.swig  _partials     _third-party  category.swig page.swig     schedule.swig</span><br></pre></td></tr></table></figure>

<h2 id="3-å‚è€ƒé“¾æ¥"><a href="#3-å‚è€ƒé“¾æ¥" class="headerlink" title="3. å‚è€ƒé“¾æ¥"></a>3. å‚è€ƒé“¾æ¥</h2><blockquote>
<ol>
<li>åšå®¢æ­å»ºå‚è€ƒé“¾æ¥ï¼š<a href="https://www.jianshu.com/p/cbf8ba8af532" target="_blank" rel="noopener">https://www.jianshu.com/p/cbf8ba8af532</a></li>
</ol>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/09/rex-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zyt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Matrix">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/09/rex-2/" itemprop="url">Rex è‡ªåŠ¨åŒ–åˆ©ç”¨å¼•æ“åˆ†æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-09T22:07:40+08:00">
                2020-07-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rex/" itemprop="url" rel="index">
                    <span itemprop="name">Rex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>è½¬è½½è‡ªï¼š<a href="https://xz.aliyun.com/t/7179" target="_blank" rel="noopener">https://xz.aliyun.com/t/7179</a></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨çœ‹ rexï¼Œæ²¡æœ‰å®˜æ–¹æ–‡æ¡£ï¼Œå·²æœ‰çš„æ•™ç¨‹ä¹Ÿæœ‰ç‚¹è¿‡æ—¶ï¼ŒåŸºæœ¬åªèƒ½é€šè¿‡çœ‹æºç å­¦ä¹ ã€‚</p>
<p>æœ¬ç¯‡æ•™ç¨‹å½“ä½œæ˜¯å­¦ä¹ çš„è®°å½•ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åŠ©å¯¹ rex æ„Ÿå…´è¶£çš„åŒå­¦å¯¹ rex çš„æ¶æ„å’Œä½¿ç”¨æ–¹å¼æœ‰ä¸ªæ•´ä½“çš„è®¤è¯†ã€‚</p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Rex æ˜¯ Shellphish å›¢é˜Ÿå¼€å‘çš„è‡ªåŠ¨ç”Ÿæˆ exploit çš„å¼•æ“ï¼Œæ˜¯ Mechaphish ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œæœ€åˆç”¨äº CGC ç«èµ›ã€‚</p>
<p>Rex åŸºäºç¡¬ä»¶æ¨¡æ‹Ÿå™¨ QEMU å’Œ angr ï¼Œé€šè¿‡æ··åˆæ‰§è¡Œï¼ˆConcolic Executionï¼‰å¤ç°å´©æºƒè·¯å¾„ï¼Œæ ¹æ®å¯„å­˜å™¨åŠå†…å­˜ä¿¡æ¯å¯¹æ¼æ´ç±»å‹/å¯åˆ©ç”¨æ€§è¿›è¡Œåˆ¤å®šç­‰ï¼Œå¹¶å°è¯•åº”ç”¨å¤šç§æ¼æ´åˆ©ç”¨æŠ€æœ¯è‡ªåŠ¨ç”Ÿæˆåˆ©ç”¨è„šæœ¬ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ä¼šä»‹ç» rex å®‰è£…/é¡¶å±‚æ¥å£/å†…éƒ¨å®ç°/ç›¸å…³ä¾èµ–ç­‰å†…å®¹ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æœ‰ä¸¤ç§æ–¹æ³•</p>
<ol>
<li>å®‰è£… rex åŠå…¶ä¾èµ–</li>
<li>ç›´æ¥å®‰è£… mechaphish é•œåƒ</li>
</ol>
<p>æ¨èç›´æ¥ä½¿ç”¨ shellphish/mechaphish docker é•œåƒï¼Œæ¯”è¾ƒæ–¹ä¾¿</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull shellphish&#x2F;mechaphish; </span><br><span class="line">docker run -it shellphish&#x2F;mechaphish</span><br></pre></td></tr></table></figure>

<p>rex åŸºäº angrï¼Œå…³äº angr çš„ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ•™ç¨‹ã€‚</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>é¦–å…ˆæµ‹è¯•ä¸€ä¸‹ rex æ˜¯å¦å®‰è£…æˆåŠŸï¼Œç®€å•æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tg &#x3D; archr.targets.LocalTarget(&lt;path_to_binary&gt;, target_os&#x3D;&#39;cgc&#39;)</span><br><span class="line">crash &#x3D; rex.Crash(tg, &lt;input&gt;)</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆéœ€è¦åˆ›å»º target ,ç±»å‹æ˜¯ archr.targets.Target å¹¶æŒ‡å®šé…ç½®ã€‚</p>
<p>æ¥ä¸‹æ¥é€šè¿‡ rex.Crash æ¥å£ï¼Œä¼ é€’åˆ›å»ºçš„ target å’Œå¯ä»¥è§¦å‘ crash çš„è¾“å…¥ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— Crash å¯¹è±¡ï¼Œä¾¿å¯ä»¥å¯¹ Crash å¯¹è±¡è¿›è¡Œä¸€ç³»åˆ—åˆ†æï¼Œä¸‹é¢ä¼šæ¶‰åŠå¯¹ Crash å¯¹è±¡çš„æ“ä½œã€‚</p>
<p>è¿™é‡Œ path_to_binary ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ï¼Œtarget_os æŒ‡å®šç³»ç»Ÿï¼Œcgc æˆ–è€… linux, è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ cgc çš„æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼ˆå¯ä»¥åœ¨binaries ä¸­æ‰¾åˆ°ï¼‰</p>
<p>ç®€å•æµ‹è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t &#x3D; archr.targets.LocalTarget([&quot;&#x2F;home&#x2F;angr-dev&#x2F;binaries&#x2F;tests&#x2F;defcon24&#x2F;legit_00003&quot;], target_os&#x3D;&#39;cgc&#39;)</span><br><span class="line">crash &#x3D; rex.Crash(t, b&quot;\x00\x0b1\xc1\x00\x0c\xeb\xe4\xf1\xf1\x14\r\rM\r\xf3\x1b\r\r\r~\x7f\x1b\xe3\x0c&#96;_222\r\rM\r\xf3\x1b\r\x7f\x002\x7f~\x7f\xe2\xff\x7f\xff\xff\x8b\xc7\xc9\x83\x8b\x0c\xeb\x80\x002\xac\xe2\xff\xff\x00t\x8bt\x8bt_o_\x00t\x8b\xc7\xdd\x83\xc2t~n~~\xac\xe2\xff\xff_k_\x00t\x8b\xc7\xdd\x83\xc2t~n~~\xac\xe2\xff\xff\x00t\x8bt\x8b\xac\xf1\x83\xc2t~c\x00\x00\x00~~\x7f\xe2\xff\xff\x00t\x9e\xac\xe2\xf1\xf2@\x83\xc3t&quot;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰å‡ºç°æŠ¥é”™åˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚</p>
<p>rex ä¹Ÿæä¾›äº†å¤šç§æµ‹è¯•æ ·ä¾‹, å¯ä»¥åœ¨ tests ç›®å½•æŸ¥çœ‹, æµ‹è¯•ä½¿ç”¨çš„æ–‡ä»¶å¯ä»¥åœ¨ binaries ä»“åº“ ä¸­æ‰¾åˆ°.</p>
<h2 id="é¡¶å±‚æ¥å£"><a href="#é¡¶å±‚æ¥å£" class="headerlink" title="é¡¶å±‚æ¥å£"></a>é¡¶å±‚æ¥å£</h2><p>ä½¿ç”¨ rex é€šå¸¸æ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»º target å¯¹è±¡ï¼Œéšåä½¿ç”¨ target å’Œ input åˆ›å»º Crash å¯¹è±¡</li>
<li>å¯¹ Crash è¿›è¡Œåˆ†æï¼Œè°ƒç”¨ explore æ¢ç´¢è·¯å¾„ï¼Œè°ƒç”¨ exploit() æ–¹æ³•æ„å»º exp</li>
<li>è·å– exploit ç›¸å…³ä¿¡æ¯ï¼Œå¯¼å‡ºåˆ°æ–‡ä»¶ç­‰<br>æ­¤å¤–ä¹Ÿå¯ä»¥å¯¹ state æ·»åŠ çº¦æŸè¿›è¡Œæ±‚è§£ç­‰ï¼Œè‡ªè¡Œæ¢ç´¢ã€‚</li>
</ol>
<h3 id="Crash-å¯¹è±¡"><a href="#Crash-å¯¹è±¡" class="headerlink" title="Crash å¯¹è±¡"></a>Crash å¯¹è±¡</h3><p>å±æ€§</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- crash_types è¿”å› crash çš„æ¼æ´ç±»å‹</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- explorable()  Determine if the crash can be explored with the &#39;crash explorer&#39;.</span><br><span class="line">- exploitable() Determine if the crash is exploitable.</span><br><span class="line">- exploit() è¿”å›ä¸€ä¸ª ExploitFactory  å®ä¾‹ï¼Œç”¨äºç®¡ç†å’Œæ„å»º exp</span><br><span class="line">- explore() explore a crash further to find new bugs</span><br><span class="line">- memory_control()  determine what symbolic memory we control which is at a constant address</span><br><span class="line">- stack_control()  determine what symbolic memory we control on the stack.</span><br><span class="line">- copy() æ‹·è´ crash å¯¹è±¡</span><br><span class="line">- checkpoint()   Save intermediate results (traced states, etc.) to a file </span><br><span class="line">- checkpoint_restore()</span><br></pre></td></tr></table></figure>

<h3 id="ExploitFactory"><a href="#ExploitFactory" class="headerlink" title="ExploitFactory"></a>ExploitFactory</h3><p>é€šè¿‡ crash çš„ exploit æ–¹æ³•æˆ‘ä»¬å¯ä»¥è·å¾— ExploitFactory å®ä¾‹ï¼Œç”¨äºç®¡ç†å’Œæ„å»º exploitã€‚</p>
<p>ExploitFactory æœ‰ä¸€ä¸ªé‡è¦çš„å±æ€§ arsenalï¼Œæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œç”¨æ¥å­˜å‚¨å¯¹åº” technique çš„ exploit, å…³äº rex ä¸­å®ç°çš„ technique åé¢ä¼šæ¶‰åŠã€‚</p>
<h3 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h3><p>rex å®šä¹‰äº†å¦‚ä¸‹å‡ ç§æ¼æ´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">IP_OVERWRITE              &#x3D; &quot;ip_overwrite&quot;</span><br><span class="line">    PARTIAL_IP_OVERWRITE      &#x3D; &quot;partial_ip_overwrite&quot;</span><br><span class="line">    UNCONTROLLED_IP_OVERWRITE &#x3D; &quot;uncontrolled_ip_overwrite&quot;</span><br><span class="line">    BP_OVERWRITE              &#x3D; &quot;bp_overwrite&quot;</span><br><span class="line">    PARTIAL_BP_OVERWRITE      &#x3D; &quot;partial_bp_overwrite&quot;</span><br><span class="line">    WRITE_WHAT_WHERE          &#x3D; &quot;write_what_where&quot;</span><br><span class="line">    WRITE_X_WHERE             &#x3D; &quot;write_x_where&quot;</span><br><span class="line">    UNCONTROLLED_WRITE        &#x3D; &quot;uncontrolled_write&quot; # a write where the destination address is uncontrolled</span><br><span class="line">    ARBITRARY_READ            &#x3D; &quot;arbitrary_read&quot;</span><br><span class="line">    NULL_DEREFERENCE          &#x3D; &quot;null_dereference&quot;</span><br><span class="line">    ARBITRARY_TRANSMIT        &#x3D; &quot;arbitrary_transmit&quot; # transmit where the buf argument is completely controlled</span><br><span class="line">    ARBITRARY_RECEIVE         &#x3D; &quot;arbitrary_receive&quot; # receive where the buf argument is completel controlled</span><br></pre></td></tr></table></figure>

<h2 id="å†…éƒ¨è§£è¯»"><a href="#å†…éƒ¨è§£è¯»" class="headerlink" title="å†…éƒ¨è§£è¯»"></a>å†…éƒ¨è§£è¯»</h2><p>Rex å†…éƒ¨å®ç°ä¸»è¦åŒ…å«ä¸‰ä¸ªæ¨¡å—:</p>
<ul>
<li>Crashï¼šé‡ç°å´©æºƒè·¯å¾„ï¼ŒåŒ…æ‹¬æ¼æ´ç±»å‹åˆ¤å®š, Crash çš„å¯åˆ©ç”¨æ€§åˆ¤å®šç­‰ï¼›</li>
<li>Techniqueï¼šå¯¹äºå¯åˆ©ç”¨çš„ Crashï¼Œé‡‡å–ç›¸åº”çš„åˆ©ç”¨æŠ€æœ¯ï¼Œæ„é€  Exploitï¼›</li>
<li>Exploitï¼šè°ƒç”¨å„å­æ¨¡å—ï¼Œè‡ªåŠ¨ç”Ÿæˆ Exploit</li>
</ul>
<p>å¯ä»¥ç®€å•ç†è§£æˆ crash + technique = exploit ,ä¸‹é¢æˆ‘ä»¬æ¥çœ‹å…·ä½“å†…å®¹</p>
<h3 id="crash-åˆ†æ"><a href="#crash-åˆ†æ" class="headerlink" title="crash åˆ†æ"></a>crash åˆ†æ</h3><p>å¯¼å…¥ crash åï¼Œé¦–å…ˆå¯¹ crash è¿›è¡Œ traceã€ç­›é€‰å†…å­˜å†™æ“ä½œå’Œ åˆ¤å®šæ¼æ´ç±»å‹ã€‚å¯¹åº”çš„å‡½æ•°åˆ†åˆ«ä¸º _trace / _filter_memory_writes / _triage_crash</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹è¿™ä¸‰ä¸ªå‡½æ•°è¿›è¡Œåˆ†æï¼š</p>
<h3 id="è·¯å¾„é‡ç°ï¼ˆtracing"><a href="#è·¯å¾„é‡ç°ï¼ˆtracing" class="headerlink" title="è·¯å¾„é‡ç°ï¼ˆtracing)"></a>è·¯å¾„é‡ç°ï¼ˆtracing)</h3><p>å‡½æ•°ï¼š _trace</p>
<p>ä½¿ç”¨ç»™å®šçš„è¾“å…¥ï¼Œé€šè¿‡ç¬¦å·æ‰§è¡Œï¼Œé‡ç°è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ Crash ä¼šæŠ›å‡º NonCrashingInput å¼‚å¸¸.</p>
<p>é¦–å…ˆä½¿ç”¨ç”¨æˆ·è¾“å…¥è·å¾—å…·ä½“çš„ traceï¼Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># collect a concrete trace</span></span><br><span class="line">   save_core = <span class="literal">True</span></span><br><span class="line">   <span class="keyword">if</span> isinstance(self.tracer_bow, archr.arsenal.RRTracerBow):</span><br><span class="line">       save_core = <span class="literal">False</span></span><br><span class="line">   r = self.tracer_bow.fire(testcase=test_case, channel=channel,save_core=save_core)</span><br></pre></td></tr></table></figure>

<p>å†è¿›è¡Œç¬¦å·åŒ– trace</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self._t = r.tracer_technique(keep_predecessors=<span class="number">2</span>, copy_states=<span class="literal">False</span>, mode=TracingMode.Strict)</span><br><span class="line">simgr.use_technique(self._t)</span><br><span class="line">simgr.use_technique(angr.exploration_techniques.Oppologist())</span><br></pre></td></tr></table></figure>

<p>ç»“æŸ trace, æ£€æŸ¥æ˜¯å¦æœ‰ crash</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tracing completed</span></span><br><span class="line">        <span class="comment"># if there was no crash we'll have to use the previous path's state</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'crashed'</span> <span class="keyword">in</span> simgr.stashes:</span><br><span class="line">            <span class="comment"># the state at crash time</span></span><br><span class="line">            self.state = simgr.crashed[<span class="number">0</span>]</span><br><span class="line">            <span class="comment"># a path leading up to the crashing basic block</span></span><br><span class="line">            self.prev = self._t.predecessors[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.state = simgr.traced[<span class="number">0</span>]</span><br><span class="line">            self.prev = self.state</span><br></pre></td></tr></table></figure>

<h3 id="è·å¾—å†…å­˜å†™æ“ä½œ"><a href="#è·å¾—å†…å­˜å†™æ“ä½œ" class="headerlink" title="è·å¾—å†…å­˜å†™æ“ä½œ"></a>è·å¾—å†…å­˜å†™æ“ä½œ</h3><p>_filter_memory_writes è·å¾—æ‰€æœ‰çš„å†™å†…å­˜æ“ä½œï¼Œå¹¶å°†åˆ†æˆç¬¦å·å†…å­˜ï¼ˆ symbolic memory bytes ï¼‰å’Œ flag å†…å­˜ï¼ˆ flag memory bytes ï¼‰ã€‚flag memory é’ˆå¯¹çš„æ˜¯ cgc æ ¼å¼æ–‡ä»¶ï¼Œå…¶ä»–æƒ…å†µä¸‹ä¸ºç©ºã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_filter_memory_writes</span><span class="params">(self)</span>:</span></span><br><span class="line">        memory_writes = sorted(self.state.memory.mem.get_symbolic_addrs())</span><br><span class="line">        <span class="keyword">if</span> self.is_cgc:</span><br><span class="line">            <span class="comment"># remove all memory writes that directly end up in the CGC flag page (0x4347c000 - 0x4347d000)</span></span><br><span class="line">            memory_writes = [m <span class="keyword">for</span> m <span class="keyword">in</span> memory_writes <span class="keyword">if</span> m // <span class="number">0x1000</span> != <span class="number">0x4347c</span>]</span><br><span class="line">        user_writes = [m <span class="keyword">for</span> m <span class="keyword">in</span> memory_writes <span class="keyword">if</span></span><br><span class="line">                       any(<span class="string">"aeg_stdin"</span> <span class="keyword">in</span> v <span class="keyword">for</span> v <span class="keyword">in</span> self.state.memory.load(m, <span class="number">1</span>).variables)]</span><br><span class="line">        <span class="keyword">if</span> self.is_cgc:</span><br><span class="line">            flag_writes = [m <span class="keyword">for</span> m <span class="keyword">in</span> memory_writes <span class="keyword">if</span></span><br><span class="line">                           any(v.startswith(<span class="string">"cgc-flag"</span>) <span class="keyword">for</span> v <span class="keyword">in</span> self.state.memory.load(m, <span class="number">1</span>).variables)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag_writes = []</span><br><span class="line">        l.debug(<span class="string">"Finished filtering memory writes."</span>)</span><br><span class="line">        self.symbolic_mem = self._segment(user_writes)</span><br><span class="line">        self.flag_mem = self._segment(flag_writes)</span><br></pre></td></tr></table></figure>

<h3 id="æ¼æ´ç±»å‹åˆ¤æ–­-triage-crash"><a href="#æ¼æ´ç±»å‹åˆ¤æ–­-triage-crash" class="headerlink" title="æ¼æ´ç±»å‹åˆ¤æ–­(triage_crash)"></a>æ¼æ´ç±»å‹åˆ¤æ–­(triage_crash)</h3><p>rex ä¸­ _triage_crash å‡½æ•°ç”¨äºåˆ¤æ–­ crash å¯¹åº”çš„æ¼æ´ç±»å‹ï¼Œæ¼æ´ç±»å‹ä¹‹åçš„å¯åˆ©ç”¨æ€§åˆ¤å®š</p>
<p>æ¼æ´åˆ¤æ–­åŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ£€æŸ¥ ip æ˜¯å¦ç¬¦å·åŒ–ï¼ˆå³ipæ˜¯å¦å¯æ§ï¼‰ï¼Œå¹¶ä¸”æ£€æŸ¥å¯æ§çš„å¤§å°ã€‚é€šè¿‡æ­¤æˆ‘ä»¬å¯ä»¥å°†æ¼æ´åˆ¤å®šä¸º IP_OVERWRITE / PARTIAL_IP_OVERWRITEã€‚</li>
<li>æ£€æŸ¥ bp æ˜¯å¦ç¬¦å·åŒ–ï¼Œå¹¶ä¸”æ£€æŸ¥å¯æ§çš„å¤§å°ï¼Œé€šè¿‡æ­¤æˆ‘ä»¬å¯ä»¥æ¼æ´åˆ¤å®šä¸º BP_OVERWRITE / PARTIAL_BP_OVERWRITE</li>
<li>æ£€æŸ¥è§¦å‘å´©æºƒæ—¶å‰ä¸€ä¸ª Stateï¼ŒæŸ¥çœ‹æœ€è¿‘çš„æ“ä½œï¼ˆ recent_actions ï¼‰ç­›é€‰å‡ºå†…å­˜è¯»å†™åœ°å€å¯æ§çš„æ“ä½œï¼Œå¾—åˆ°æ•°ç»„ symbolic_actions</li>
<li>å¦‚æœç¬¦å·åŒ–æ“ä½œä¸­æœ‰å†…å­˜å†™ï¼Œåˆ™åˆ¤æ–­å†™æ•°æ®æ˜¯å¦å¯æ§ï¼Œé€šè¿‡æ­¤æˆ‘ä»¬å¯ä»¥å°†æ¼æ´åˆ¤å®šä¸º WRITE_WHAT_WHERE / WRITE_X_WHERE ã€‚</li>
<li>å¦‚æœç¬¦å·åŒ–æ“ä½œä¸­æœ‰å†…å­˜è¯»ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¼æ´åˆ¤å®šä¸º ARBITRARY_READ ã€‚</li>
</ol>
<p>ä»¥ä¸‹æˆªå–è¯¥å‡½æ•°çš„éƒ¨åˆ†å†…å®¹å¸®åŠ©ç†è§£ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ¤æ–­ ip æ˜¯å¦å¯æ§ï¼Œbp ç±»ä¼¼        </span></span><br><span class="line">    <span class="keyword">if</span> self.state.solver.symbolic(ip): </span><br><span class="line">        <span class="comment"># how much control of ip do we have?</span></span><br><span class="line">        <span class="keyword">if</span> self._symbolic_control(ip) &gt;= self.state.arch.bits:</span><br><span class="line">            l.info(<span class="string">"detected ip overwrite vulnerability"</span>)</span><br><span class="line">            self.crash_types.append(Vulnerability.IP_OVERWRITE)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l.info(<span class="string">"detected partial ip overwrite vulnerability"</span>)</span><br><span class="line">            self.crash_types.append(Vulnerability.PARTIAL_IP_OVERWRITE)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç­›é€‰å‡ºç›®çš„åœ°å€å¯æ§çš„æ“ä½œ</span></span><br><span class="line">        <span class="comment"># grab the all actions in the last basic block</span></span><br><span class="line">        symbolic_actions = [ ]</span><br><span class="line">        <span class="keyword">if</span> self._t <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> self._t.last_state <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            recent_actions = reversed(self._t.last_state.history.recent_actions)</span><br><span class="line">            state = self._t.last_state</span><br><span class="line">            <span class="comment"># <span class="doctag">TODO:</span> this is a dead assignment! what was this supposed to be?</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            recent_actions = reversed(self.state.history.actions)</span><br><span class="line">            state = self.state</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> recent_actions:</span><br><span class="line">            <span class="keyword">if</span> a.type == <span class="string">'mem'</span>:</span><br><span class="line">                <span class="keyword">if</span> self.state.solver.symbolic(a.addr.ast):</span><br><span class="line">                    symbolic_actions.append(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ¤æ–­æ˜¯å†…å­˜è¯»è¿˜æ˜¯å†…å­˜å†™ï¼Œå¹¶åˆ¤æ–­æ•°æ®æ˜¯å¦å¯æ§ï¼Œç”±æ­¤ç¡®å®šæ¼æ´ç±»å‹</span></span><br><span class="line">        <span class="keyword">for</span> sym_action <span class="keyword">in</span> symbolic_actions:</span><br><span class="line">            <span class="keyword">if</span> sym_action.action == <span class="string">"write"</span>:</span><br><span class="line">                <span class="keyword">if</span> self.state.solver.symbolic(sym_action.data):</span><br><span class="line">                    l.info(<span class="string">"detected write-what-where vulnerability"</span>)</span><br><span class="line">                    self.crash_types.append(Vulnerability.WRITE_WHAT_WHERE)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    l.info(<span class="string">"detected write-x-where vulnerability"</span>)</span><br><span class="line">                    self.crash_types.append(Vulnerability.WRITE_X_WHERE)</span><br><span class="line"></span><br><span class="line">                self.violating_action = sym_action</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> sym_action.action == <span class="string">"read"</span>:</span><br><span class="line">                <span class="comment"># special vulnerability type, if this is detected we can explore the crash further</span></span><br><span class="line">                l.info(<span class="string">"detected arbitrary-read vulnerability"</span>)</span><br><span class="line">                self.crash_types.append(Vulnerability.ARBITRARY_READ)</span><br><span class="line"></span><br><span class="line">                self.violating_action = sym_action</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>å®Œæˆæ¼æ´ç±»å‹åˆ¤å®šåï¼Œæˆ‘ä»¬ä¼šå¯¹ crash è¿›è¡Œä¸€äº›åˆ¤æ–­å¦‚ explorable/leakableï¼Œå¦‚ explore ç›®çš„æ˜¯å¯»æ‰¾ä¸€ä¸ªæ›´æœ‰ä»·å€¼çš„ crash, æ–¹ä¾¿æ¼æ´åˆ©ç”¨ã€‚</p>
<h3 id="explore"><a href="#explore" class="headerlink" title="explore"></a>explore</h3><p>é¦–å…ˆåˆ¤æ–­ crash æ˜¯å¦å¯ explore, å¯ä»¥ explore çš„æ¼æ´ç±»å‹æ˜¯: ARBITRARY_READ/WRITE_WHAT_WHERE/WRITE_X_WHERE</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">explorable</span><span class="params">(self)</span>:</span></span><br><span class="line">        explorables = [Vulnerability.ARBITRARY_READ, Vulnerability.WRITE_WHAT_WHERE, Vulnerability.WRITE_X_WHERE]</span><br><span class="line">        <span class="keyword">return</span> self.one_of(explorables)</span><br></pre></td></tr></table></figure>

<p>explore ä¸»è¦é’ˆå¯¹ä»»æ„å†…å­˜è¯»å†™æ¼æ´ï¼Œå¯¹åº”ä¸¤ç§å®ç°ï¼š_explore_arbitrary_read å’Œ _explore_arbitrary_writeã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> self.one_of([Vulnerability.ARBITRARY_READ]):</span><br><span class="line">                self._explore_arbitrary_read(path_file)</span><br><span class="line">        <span class="keyword">elif</span> self.one_of([Vulnerability.WRITE_WHAT_WHERE, Vulnerability.WRITE_X_WHERE]):</span><br><span class="line">            self._explore_arbitrary_write(path_file)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> CannotExplore(<span class="string">"unknown explorable crash type: %s"</span> % self.crash_types)</span><br></pre></td></tr></table></figure>

<p>_explore_arbitrary_read / _explore_arbitrary_write è¿›è¡Œè·¯å¾„æ¢ç´¢ï¼Œåˆ†åˆ«å¯¹åº”ä»»æ„å†™å’Œä»»æ„è¯»æ¼æ´ï¼Œä½¿è¯»å†™çš„åœ°å€æ˜¯ç¬¦å·åŒ–åœ°å€ï¼Œå³æˆ‘ä»¬å¯æ§çš„ ( point the violating address at a symbolic memory region )ï¼Œè¿”å›ä¸€ä¸ª crash å¯¹è±¡ã€‚</p>
<h3 id="å¯åˆ©ç”¨æ€§åˆ¤å®š"><a href="#å¯åˆ©ç”¨æ€§åˆ¤å®š" class="headerlink" title="å¯åˆ©ç”¨æ€§åˆ¤å®š"></a>å¯åˆ©ç”¨æ€§åˆ¤å®š</h3><p>é€šè¿‡è°ƒç”¨ exploitable æ¥å£åˆ¤æ–­ crash æ˜¯å¦å¯åˆ©ç”¨ï¼Œrex ä¼šåˆ¤æ–­ Crash çš„æ¼æ´ç±»å‹æ˜¯å¦å±äºå¯ exploitable æ¼æ´ä¹‹ä¸€ ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploitable</span><span class="params">(self)</span>:</span></span><br><span class="line">        exploitables = [Vulnerability.IP_OVERWRITE, Vulnerability.PARTIAL_IP_OVERWRITE, Vulnerability.BP_OVERWRITE,</span><br><span class="line">                Vulnerability.PARTIAL_BP_OVERWRITE, Vulnerability.WRITE_WHAT_WHERE, Vulnerability.WRITE_X_WHERE]</span><br><span class="line">        <span class="keyword">return</span> self.one_of(exploitables)</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥æ˜¯å¦å¯ä»¥æ³„éœ²ä¿¡æ¯, åˆ¤æ–­ crash ç±»å‹æ˜¯å¦å±äº ARBITRARY_READ/ARBITRARY_TRANSMIT å…¶ä¸­ä¸€ç§.</p>
<h3 id="Technique-å¯¹è±¡"><a href="#Technique-å¯¹è±¡" class="headerlink" title="Technique å¯¹è±¡"></a>Technique å¯¹è±¡</h3><p>æ¯ä¸ª technique éƒ½æ˜¯ Technique å¯¹è±¡çš„å­ç±», ä¸»è¦å¯¹ check / apply è¿™ä¸¤ä¸ªæ¥å£è¿›è¡Œé‡å†™. åŒæ—¶ Technique å¯¹è±¡å®ç°äº†ä¸€äº›é€šç”¨çš„æ¥å£, ä½œä¸ºæ„é€  exploit çš„è¾…åŠ©å‡½æ•°.</p>
<p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹ check / apply</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">check: æ£€æŸ¥å¯¹äºç»™å®šçš„crash, è¯¥æŠ€æœ¯èƒ½å¦åº”ç”¨åˆ° binary ä¸Š,è¿”å›å¸ƒå°”å€¼</span><br><span class="line"></span><br><span class="line">apply : åœ¨binaryçš„å´©æºƒçŠ¶æ€ç‚¹åº”ç”¨è¯¥æŠ€æœ¯,è¿”å› Exploit å¯¹è±¡æˆ–æŠ›å‡º  CannotExploit  å¼‚å¸¸</span><br></pre></td></tr></table></figure>

<p>apply å…¶å®å°±æ˜¯æ ¹æ®æ¯ä¸ªæŠ€æœ¯çš„ä¸åŒï¼Œæ·»åŠ ä¸åŒçš„çº¦æŸã€‚</p>
<p>æ¯ç§åŒ…å« applicable_to å±æ€§,è¡¨ç¤ºå¯ä»¥åº”ç”¨çš„å¹³å°, unix æˆ–è€… cgc</p>
<p>ä»¥ä¸‹æ˜¯ technique çš„åŸºæœ¬ä¿¡æ¯, åŸºæœ¬é€šè¿‡åç§°å°±èƒ½çŸ¥é“æ”»å‡»æŠ€æœ¯ï¼Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œå®ƒä»¬çš„å®ç°ä¹Ÿæ¯”è¾ƒæœ´ç´ ã€‚</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>é™å®šæ¼æ´ç±»å‹</th>
<th>å…¶ä»–æ¡ä»¶</th>
<th>å¹³å°</th>
</tr>
</thead>
<tbody><tr>
<td>call_jmp_sp_shellcode</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td>æ ˆå¯æ‰§è¡Œ</td>
<td>unix</td>
</tr>
<tr>
<td>call_shellcode</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td>æ ˆå¯æ‰§è¡Œ</td>
<td>unix</td>
</tr>
<tr>
<td>circumstantially_set_register</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td></td>
<td>cgc</td>
</tr>
<tr>
<td>rop_leak_memory</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td></td>
<td>cgc</td>
</tr>
<tr>
<td>rop_register_control</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td></td>
<td>unix</td>
</tr>
<tr>
<td>rop_set_register</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td></td>
<td>cgc</td>
</tr>
<tr>
<td>rop_to_accept_system</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td>å­˜åœ¨</td>
<td>accept&amp; readå‡½æ•°</td>
</tr>
<tr>
<td>rop_to_execl</td>
<td>IP_OVERWRITE/  PARTIAL_IP_OVERWRITE</td>
<td>å­˜åœ¨</td>
<td>execl&amp;dup2 å‡½æ•°</td>
</tr>
<tr>
<td>rop_to_system</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td>å­˜åœ¨</td>
<td>system å‡½æ•°</td>
</tr>
<tr>
<td>rop_to_system_complicated</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td>libc</td>
<td>è¢«åŠ è½½&amp; system å‡½æ•° &amp; plt</td>
</tr>
<tr>
<td>shellcode_leak_address</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td>æ ˆå¯æ‰§è¡Œ</td>
<td>cgc</td>
</tr>
<tr>
<td>shellcode_set_register</td>
<td>IP_OVERWRITE / PARTIAL_IP_OVERWRITE</td>
<td>æ ˆå¯æ‰§è¡Œ</td>
<td>cgc</td>
</tr>
</tbody></table>
<p>å¯ä»¥åœ¨è°ƒç”¨ exploit æ—¶è®¾ç½® blacklist_techniques å‚æ•°æ’é™¤ä¸éœ€è¦ä½¿ç”¨çš„æŠ€æœ¯.</p>
<p>æˆåŠŸåº”ç”¨ Technique ä¼šè¿”å› Exploit å¯¹è±¡ï¼Œæ¥ä¸‹æ¥ä»‹ç» Exploit å¯¹è±¡ã€‚</p>
<h2 id="Exploit-å¯¹è±¡"><a href="#Exploit-å¯¹è±¡" class="headerlink" title="Exploit å¯¹è±¡"></a>Exploit å¯¹è±¡</h2><blockquote>
<p>An Exploit object represents the successful application of an exploit technique to a crash state.</p>
</blockquote>
<p>rex å®ç°äº† ExploitFactory ç±»ï¼Œç”¨äºç®¡ç†å’Œæ„å»º exploit,</p>
<p>è°ƒç”¨ exploit() æ–¹æ³•æ—¶ï¼ŒExploitFactory ä¼šä¾æ¬¡åº”ç”¨æ¯ä¸€ç§åˆ©ç”¨æŠ€æœ¯, å°è¯•ç”Ÿæˆ exploit, å¾—åˆ°çš„ exploit ä¼šä»¥arsenal[<techinique_name>] å½¢å¼å­˜å‚¨åœ¨ arsenal å±æ€§ä¸­. é’ˆå¯¹ CGC å®ç°äº† CGCExploitFactory ç±».</p>
<p>æ„å»º exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">(self, blacklist_symbolic_explore=True, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initialize an exploit factory, with which you can build exploits.</span></span><br><span class="line"><span class="string">        :return:    An initialized ExploitFactory instance.</span></span><br><span class="line"><span class="string">        :rtype:     ExploitFactory</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        factory = self._prepare_exploit_factory(blacklist_symbolic_explore, **kwargs)</span><br><span class="line">        factory.initialize()</span><br><span class="line">        <span class="keyword">return</span> factory</span><br></pre></td></tr></table></figure>

<p>_prepare_exploit_factory å‡½æ•°ä¸»è¦ä¸º exploit çš„ç”Ÿæˆåšä¸€äº›å‡†å¤‡æ“ä½œï¼Œæ¯”å¦‚è®¾ç½® technique çš„é»‘åå•ï¼Œåˆ¤æ–­è¾“å…¥ç±»å‹ç­‰ã€‚</p>
<h2 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ä»¥ä¸‹æ˜¯åˆ†åˆ«å¯¹ cgc å’Œ linux ä¸¤ç§æ ¼å¼çš„æµ‹è¯•æ ·ä¾‹</p>
<p>cgc</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_legit_00003</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Test exploration and exploitation of legit_00003.</span></span><br><span class="line">    inp = <span class="string">b"1\n"</span> + <span class="string">b"A"</span> * <span class="number">200</span> <span class="comment">#è®¾ç½®è¾“å…¥å†…å®¹</span></span><br><span class="line">    path = os.path.join(bin_location, <span class="string">"tests/defcon24/legit_00003"</span>)</span><br><span class="line">    <span class="keyword">with</span> archr.targets.LocalTarget([path], target_os=<span class="string">'cgc'</span>) <span class="keyword">as</span> target:</span><br><span class="line">        crash = rex.Crash(target, inp, fast_mode=<span class="literal">True</span>, rop_cache_path=os.path.join(cache_location, <span class="string">'legit_00003'</span>))</span><br><span class="line"></span><br><span class="line">        nose.tools.assert_true(crash.explorable())  <span class="comment">#åˆ¤æ–­æ˜¯å¦å¯ä»¥ explore</span></span><br><span class="line">        nose.tools.assert_true(crash.one_of(Vulnerability.WRITE_WHAT_WHERE)) <span class="comment"># æ¼æ´æ˜¯å¦ä¸ºä»»æ„å†™</span></span><br><span class="line"></span><br><span class="line">        crash.explore() <span class="comment">#è¿›è¡Œæ¢ç´¢m</span></span><br><span class="line">        arsenal = crash.exploit(blacklist_techniques=&#123;<span class="string">'rop_set_register'</span>, <span class="string">'rop_leak_memory'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        nose.tools.assert_true(len(arsenal.register_setters) &gt;= <span class="number">2</span>)</span><br><span class="line">        nose.tools.assert_true(len(arsenal.leakers) &gt;= <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        crash.project.loader.close()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> reg_setter <span class="keyword">in</span> arsenal.register_setters:</span><br><span class="line">            nose.tools.assert_true(_do_pov_test(reg_setter))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> leaker <span class="keyword">in</span> arsenal.leakers:</span><br><span class="line">            nose.tools.assert_true(_do_pov_test(leaker))</span><br></pre></td></tr></table></figure>

<p>linux</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_linux_stacksmash_32</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Test exploiting a simple linux program with a stack buffer overflow. We should be able to exploit the test binary by</span></span><br><span class="line">    <span class="comment"># ropping to 'system', calling shellcode in the BSS and calling 'jmpsp' shellcode in the BSS.</span></span><br><span class="line"></span><br><span class="line">    inp = <span class="string">b"A"</span> * <span class="number">227</span></span><br><span class="line">    lib_path = os.path.join(bin_location, <span class="string">"tests/i386"</span>)</span><br><span class="line">    ld_path = os.path.join(lib_path, <span class="string">"ld-linux.so.2"</span>)</span><br><span class="line">    path = os.path.join(lib_path, <span class="string">"vuln_stacksmash"</span>)</span><br><span class="line">    <span class="keyword">with</span> archr.targets.LocalTarget([ld_path, <span class="string">'--library-path'</span>, lib_path, path], path, target_arch=<span class="string">'i386'</span>).build().start() <span class="keyword">as</span> target:</span><br><span class="line">        crash = rex.Crash(target, inp, fast_mode=<span class="literal">True</span>, rop_cache_path=os.path.join(cache_location, <span class="string">'vuln_stacksmash'</span>))</span><br><span class="line"></span><br><span class="line">        exploit = crash.exploit(blacklist_techniques=&#123;<span class="string">'rop_leak_memory'</span>, <span class="string">'rop_set_register'</span>&#125;)</span><br><span class="line">        crash.project.loader.close()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># make sure we're able to exploit it in all possible ways</span></span><br><span class="line">        <span class="keyword">assert</span> len(exploit.arsenal) == <span class="number">3</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="string">'rop_to_system'</span> <span class="keyword">in</span> exploit.arsenal</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">'call_shellcode'</span> <span class="keyword">in</span> exploit.arsenal</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">'call_jmp_sp_shellcode'</span> <span class="keyword">in</span> exploit.arsenal</span><br><span class="line"></span><br><span class="line">        _check_arsenal_has_send(exploit.arsenal)</span><br></pre></td></tr></table></figure>

<h2 id="ç›¸å…³åº“"><a href="#ç›¸å…³åº“" class="headerlink" title="ç›¸å…³åº“"></a>ç›¸å…³åº“</h2><p>è¿™é‡Œé¡ºä¾¿ä»‹ç»ä¸€äº› rex ä¾èµ–çš„ archr æ¨¡å—</p>
<h3 id="archr"><a href="#archr" class="headerlink" title="archr"></a>archr</h3><p>å‰é¢æåˆ°ï¼Œåœ¨ä½¿ç”¨ rex å‰ï¼Œéœ€è¦ä½¿ç”¨ archr åˆ›å»º target å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡å®š target_path / target_os(linux /cgc) / target_arch(linux , x86_64) ç­‰.</p>
<p>archr æ¨¡å—å®ç°äº†ä»¥ target ä¸ºä¸­å¿ƒçš„åˆ†ææ¨¡å‹ã€‚ï¼ˆä¼ ç»Ÿæ˜¯ä»¥ç¨‹åº program ä¸ºä¸­å¿ƒï¼‰</p>
<p>å…¶ä¸­åŒ…å«ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œ</p>
<p>Targets: åŒ…å« target çš„è¯´æ˜ï¼Œå¦‚ä½•é…ç½®ï¼Œå¦‚ä½•å¯åŠ¨ä»¥åŠå¦‚ä½•äº¤äº’ã€‚</p>
<p>Bowsï¼šæ˜ç¡® target ç‰¹å®šçš„åˆ†æåŠ¨ä½œï¼ŒåŒ…æ‹¬ tracingï¼Œç¬¦å·æ‰§è¡Œï¼ˆsymbolic executionï¼‰ç­‰ï¼Œä¸ºäº†å®ç°ç›®æ ‡ï¼ŒBows å¯èƒ½ä¼šæ³¨å…¥ Arrows ï¼ˆå¦‚qemu-user, gdbserverç­‰ï¼‰åˆ° target ä¸­ã€‚</p>
<p>archr æä¾›äº†ä¸¤ç§ target:</p>
<ul>
<li>DockerImageTarget: docker é•œåƒ</li>
<li>LocalTargetï¼šæœ¬åœ°ç³»ç»Ÿè¿è¡Œçš„ target<br>æä¾›äº†ä»¥ä¸‹ Bows ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>DataScoutBow</td>
<td>è·å–è¿›ç¨‹å¯åŠ¨æ—¶çš„å†…å­˜æ˜ å°„ï¼Œç¯å¢ƒï¼Œå±æ€§</td>
</tr>
<tr>
<td>AngrProjectBow</td>
<td>åˆ›å»º angr Project</td>
</tr>
<tr>
<td>AngrStateBow</td>
<td>åˆ›å»º angr State</td>
</tr>
<tr>
<td>QEMUTraceBow</td>
<td>æ‰§è¡Œ qemu tracing</td>
</tr>
<tr>
<td>GDBServerBow</td>
<td>åœ¨ gdbserver ä¸­å¯åŠ¨ target</td>
</tr>
<tr>
<td>STraceBow</td>
<td>strace ç›®æ ‡ï¼ˆå³è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å’Œä¿¡å·ï¼‰</td>
</tr>
<tr>
<td>CoreBow</td>
<td>å¯åŠ¨target å¹¶æ¢å¤ core</td>
</tr>
<tr>
<td>InputFDBow</td>
<td>ç¡®å®šç”¨æˆ·è¾“å…¥çš„FDæ•°ç›®</td>
</tr>
</tbody></table>
<p>å…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹é¡¹ç›®ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¹äºè‡ªåŠ¨åŒ–åˆ©ç”¨ï¼Œrex æ¯”è¾ƒç®€é™‹ï¼Œæ¼æ´åˆ©ç”¨æŠ€æœ¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å­¦ä¹ å®ƒçš„æ€è·¯ï¼Œå¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol>
<li><a href="https://paper.seebug.org/papers/Security%20Conf/Hitcon/Hitcon-2016/1202%20R2%201510%20automatic%20binary%20exploitation%20and%20patching%20using%20mechanical%20shellphish.pdf" target="_blank" rel="noopener">https://paper.seebug.org/papers/Security%20Conf/Hitcon/Hitcon-2016/1202%20R2%201510%20automatic%20binary%20exploitation%20and%20patching%20using%20mechanical%20shellphish.pdf</a></li>
<li><a href="https://ma3k4h3d.top/2019/01/23/rex-crash/" target="_blank" rel="noopener">https://ma3k4h3d.top/2019/01/23/rex-crash/</a></li>
<li><a href="https://ma3k4h3d.top/2019/03/28/rex-1/" target="_blank" rel="noopener">https://ma3k4h3d.top/2019/03/28/rex-1/</a></li>
<li><a href="https://ma3k4h3d.top/2019/01/17/Rex-stacksmash/" target="_blank" rel="noopener">https://ma3k4h3d.top/2019/01/17/Rex-stacksmash/</a></li>
<li><a href="https://github.com/angr/rex" target="_blank" rel="noopener">https://github.com/angr/rex</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/09/rex-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zyt">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Matrix">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/07/09/rex-1/" itemprop="url">åœ¨ç”±é•œåƒ shellphish_mechaphish åˆ›å»ºçš„å®¹å™¨ä¸­è¿è¡Œrexçš„æµ‹è¯•ç¨‹åºæ—¶å€™æŠ¥é”™</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-07-09T19:14:18+08:00">
                2020-07-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rex/" itemprop="url" rel="index">
                    <span itemprop="name">Rex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æµ‹è¯•ç¨‹åºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> nose</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> archr</span><br><span class="line"><span class="keyword">import</span> rex</span><br><span class="line"><span class="keyword">import</span> colorguard</span><br><span class="line"><span class="keyword">from</span> rex.vulnerability <span class="keyword">import</span> Vulnerability</span><br><span class="line"><span class="keyword">from</span> angr.state_plugins.trace_additions <span class="keyword">import</span> FormatInfoStrToInt, FormatInfoDontConstrain</span><br><span class="line"><span class="keyword">from</span> rex.exploit.cgc.type1.cgc_type1_shellcode_exploit <span class="keyword">import</span> CGCType1ShellcodeExploit</span><br><span class="line"><span class="keyword">from</span> nose.plugins.attrib <span class="keyword">import</span> attr</span><br><span class="line"></span><br><span class="line">bin_location = str(os.path.join(os.path.dirname(os.path.realpath(__file__)), <span class="string">'../binaries'</span>))</span><br><span class="line">cache_location = str(os.path.join(bin_location, <span class="string">'tests_data/rop_gadgets_cache'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_linux_stacksmash_32</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># Test exploiting a simple linux program with a stack buffer overflow. We should be able to exploit the test binary by</span></span><br><span class="line">    <span class="comment"># ropping to 'system', calling shellcode in the BSS and calling 'jmpsp' shellcode in the BSS.</span></span><br><span class="line"></span><br><span class="line">    inp = <span class="string">b"A"</span> * <span class="number">227</span></span><br><span class="line">    lib_path = os.path.join(bin_location, <span class="string">"tests/i386"</span>)</span><br><span class="line">    ld_path = os.path.join(lib_path, <span class="string">"ld-linux.so.2"</span>)</span><br><span class="line">    path = os.path.join(lib_path, <span class="string">"vuln_stacksmash"</span>)</span><br><span class="line">    <span class="keyword">with</span> archr.targets.LocalTarget([ld_path, <span class="string">'--library-path'</span>, lib_path, path], path, target_arch=<span class="string">'i386'</span>).build().start() <span class="keyword">as</span> target:</span><br><span class="line">        crash = rex.Crash(target, inp, fast_mode=<span class="literal">True</span>, rop_cache_path=os.path.join(cache_location, <span class="string">'vuln_stacksmash'</span>))</span><br><span class="line"></span><br><span class="line">        exploit = crash.exploit(blacklist_techniques=&#123;<span class="string">'rop_leak_memory'</span>, <span class="string">'rop_set_register'</span>&#125;)</span><br><span class="line">        crash.project.loader.close()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># make sure we're able to exploit it in all possible ways</span></span><br><span class="line">        <span class="keyword">assert</span> len(exploit.arsenal) == <span class="number">3</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="string">'rop_to_system'</span> <span class="keyword">in</span> exploit.arsenal</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">'call_shellcode'</span> <span class="keyword">in</span> exploit.arsenal</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">'call_jmp_sp_shellcode'</span> <span class="keyword">in</span> exploit.arsenal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    test_linux_stacksmash_32()</span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™ä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">archr.errors.ArchrError: DataScout failed to get argv from the target process.</span><br><span class="line">stdout: b&#39;&#39;</span><br><span class="line">stderr: b&#39;setarch: failed to set personality to x86_64: Operation not permitted\n&#39;</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run æ—¶å¢åŠ å‚æ•° --privileged</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zyt</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zyt</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
